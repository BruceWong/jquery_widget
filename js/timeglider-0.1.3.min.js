/*

 // Underscore.js 1.1.7
 // (c) 2011 Jeremy Ashkenas, DocumentCloud Inc.
 // Underscore is freely distributable under the MIT license.
 // Portions of Underscore are inspired or borrowed from Prototype,
 // Oliver Steele's Functional, and John Resig's Micro-Templating.
 // For all details and documentation:
 // http://documentcloud.github.com/underscore
*/
(function(){var r=this,F=r._,A={},p=Array.prototype,H=Object.prototype,B=p.slice,x=p.unshift,w=H.toString,h=H.hasOwnProperty,I=p.forEach,C=p.map,e=p.reduce,q=p.reduceRight,s=p.filter,z=p.every,f=p.some,k=p.indexOf,o=p.lastIndexOf;H=Array.isArray;var D=Object.keys,c=Function.prototype.bind,a=function(d){return new u(d)};typeof module!=="undefined"&&module.exports?(module.exports=a,a._=a):r._=a;a.VERSION="1.1.7";var n=a.each=a.forEach=function(d,i,m){if(d!=null)if(I&&d.forEach===I)d.forEach(i,m);else if(d.length===
+d.length)for(var y=0,E=d.length;y<E;y++){if(y in d&&i.call(m,d[y],y,d)===A)break}else for(y in d)if(h.call(d,y)&&i.call(m,d[y],y,d)===A)break};a.map=function(d,i,m){var y=[];if(d==null)return y;if(C&&d.map===C)return d.map(i,m);n(d,function(E,J,L){y[y.length]=i.call(m,E,J,L)});return y};a.reduce=a.foldl=a.inject=function(d,i,m,y){var E=m!==void 0;d==null&&(d=[]);if(e&&d.reduce===e)return y&&(i=a.bind(i,y)),E?d.reduce(i,m):d.reduce(i);n(d,function(J,L,O){E?m=i.call(y,m,J,L,O):(m=J,E=true)});if(!E)throw new TypeError("Reduce of empty array with no initial value");
return m};a.reduceRight=a.foldr=function(d,i,m,y){d==null&&(d=[]);if(q&&d.reduceRight===q)return y&&(i=a.bind(i,y)),m!==void 0?d.reduceRight(i,m):d.reduceRight(i);d=(a.isArray(d)?d.slice():a.toArray(d)).reverse();return a.reduce(d,i,m,y)};a.find=a.detect=function(d,i,m){var y;g(d,function(E,J,L){if(i.call(m,E,J,L))return y=E,true});return y};a.filter=a.select=function(d,i,m){var y=[];if(d==null)return y;if(s&&d.filter===s)return d.filter(i,m);n(d,function(E,J,L){i.call(m,E,J,L)&&(y[y.length]=E)});
return y};a.reject=function(d,i,m){var y=[];if(d==null)return y;n(d,function(E,J,L){i.call(m,E,J,L)||(y[y.length]=E)});return y};a.every=a.all=function(d,i,m){var y=true;if(d==null)return y;if(z&&d.every===z)return d.every(i,m);n(d,function(E,J,L){if(!(y=y&&i.call(m,E,J,L)))return A});return y};var g=a.some=a.any=function(d,i,m){i=i||a.identity;var y=false;if(d==null)return y;if(f&&d.some===f)return d.some(i,m);n(d,function(E,J,L){if(y|=i.call(m,E,J,L))return A});return!!y};a.include=a.contains=function(d,
i){var m=false;if(d==null)return m;if(k&&d.indexOf===k)return d.indexOf(i)!=-1;g(d,function(y){if(m=y===i)return true});return m};a.invoke=function(d,i){var m=B.call(arguments,2);return a.map(d,function(y){return(i.call?i||y:y[i]).apply(y,m)})};a.pluck=function(d,i){return a.map(d,function(m){return m[i]})};a.max=function(d,i,m){if(!i&&a.isArray(d))return Math.max.apply(Math,d);var y={computed:-Infinity};n(d,function(E,J,L){J=i?i.call(m,E,J,L):E;J>=y.computed&&(y={value:E,computed:J})});return y.value};
a.min=function(d,i,m){if(!i&&a.isArray(d))return Math.min.apply(Math,d);var y={computed:Infinity};n(d,function(E,J,L){J=i?i.call(m,E,J,L):E;J<y.computed&&(y={value:E,computed:J})});return y.value};a.sortBy=function(d,i,m){return a.pluck(a.map(d,function(y,E,J){return{value:y,criteria:i.call(m,y,E,J)}}).sort(function(y,E){var J=y.criteria,L=E.criteria;return J<L?-1:J>L?1:0}),"value")};a.groupBy=function(d,i){var m={};n(d,function(y,E){var J=i(y,E);(m[J]||(m[J]=[])).push(y)});return m};a.sortedIndex=
function(d,i,m){m||(m=a.identity);for(var y=0,E=d.length;y<E;){var J=y+E>>1;m(d[J])<m(i)?y=J+1:E=J}return y};a.toArray=function(d){if(!d)return[];if(d.toArray)return d.toArray();if(a.isArray(d))return B.call(d);if(a.isArguments(d))return B.call(d);return a.values(d)};a.size=function(d){return a.toArray(d).length};a.first=a.head=function(d,i,m){return i!=null&&!m?B.call(d,0,i):d[0]};a.rest=a.tail=function(d,i,m){return B.call(d,i==null||m?1:i)};a.last=function(d){return d[d.length-1]};a.compact=function(d){return a.filter(d,
function(i){return!!i})};a.flatten=function(d){return a.reduce(d,function(i,m){if(a.isArray(m))return i.concat(a.flatten(m));i[i.length]=m;return i},[])};a.without=function(d){return a.difference(d,B.call(arguments,1))};a.uniq=a.unique=function(d,i){return a.reduce(d,function(m,y,E){if(0==E||(i===true?a.last(m)!=y:!a.include(m,y)))m[m.length]=y;return m},[])};a.union=function(){return a.uniq(a.flatten(arguments))};a.intersection=a.intersect=function(d){var i=B.call(arguments,1);return a.filter(a.uniq(d),
function(m){return a.every(i,function(y){return a.indexOf(y,m)>=0})})};a.difference=function(d,i){return a.filter(d,function(m){return!a.include(i,m)})};a.zip=function(){for(var d=B.call(arguments),i=a.max(a.pluck(d,"length")),m=Array(i),y=0;y<i;y++)m[y]=a.pluck(d,""+y);return m};a.indexOf=function(d,i,m){if(d==null)return-1;var y;if(m)return m=a.sortedIndex(d,i),d[m]===i?m:-1;if(k&&d.indexOf===k)return d.indexOf(i);m=0;for(y=d.length;m<y;m++)if(d[m]===i)return m;return-1};a.lastIndexOf=function(d,
i){if(d==null)return-1;if(o&&d.lastIndexOf===o)return d.lastIndexOf(i);for(var m=d.length;m--;)if(d[m]===i)return m;return-1};a.range=function(d,i,m){arguments.length<=1&&(i=d||0,d=0);m=arguments[2]||1;for(var y=Math.max(Math.ceil((i-d)/m),0),E=0,J=Array(y);E<y;){J[E++]=d;d+=m}return J};a.bind=function(d,i){if(d.bind===c&&c)return c.apply(d,B.call(arguments,1));var m=B.call(arguments,2);return function(){return d.apply(i,m.concat(B.call(arguments)))}};a.bindAll=function(d){var i=B.call(arguments,
1);i.length==0&&(i=a.functions(d));n(i,function(m){d[m]=a.bind(d[m],d)});return d};a.memoize=function(d,i){var m={};i||(i=a.identity);return function(){var y=i.apply(this,arguments);return h.call(m,y)?m[y]:m[y]=d.apply(this,arguments)}};a.delay=function(d,i){var m=B.call(arguments,2);return setTimeout(function(){return d.apply(d,m)},i)};a.defer=function(d){return a.delay.apply(a,[d,1].concat(B.call(arguments,1)))};var l=function(d,i,m){var y;return function(){var E=this,J=arguments,L=function(){y=
null;d.apply(E,J)};m&&clearTimeout(y);if(m||!y)y=setTimeout(L,i)}};a.throttle=function(d,i){return l(d,i,false)};a.debounce=function(d,i){return l(d,i,true)};a.once=function(d){var i=false,m;return function(){if(i)return m;i=true;return m=d.apply(this,arguments)}};a.wrap=function(d,i){return function(){var m=[d].concat(B.call(arguments));return i.apply(this,m)}};a.compose=function(){var d=B.call(arguments);return function(){for(var i=B.call(arguments),m=d.length-1;m>=0;m--)i=[d[m].apply(this,i)];
return i[0]}};a.after=function(d,i){return function(){if(--d<1)return i.apply(this,arguments)}};a.keys=D||function(d){if(d!==Object(d))throw new TypeError("Invalid object");var i=[],m;for(m in d)h.call(d,m)&&(i[i.length]=m);return i};a.values=function(d){return a.map(d,a.identity)};a.functions=a.methods=function(d){var i=[],m;for(m in d)a.isFunction(d[m])&&i.push(m);return i.sort()};a.extend=function(d){n(B.call(arguments,1),function(i){for(var m in i)i[m]!==void 0&&(d[m]=i[m])});return d};a.defaults=
function(d){n(B.call(arguments,1),function(i){for(var m in i)d[m]==null&&(d[m]=i[m])});return d};a.clone=function(d){return a.isArray(d)?d.slice():a.extend({},d)};a.tap=function(d,i){i(d);return d};a.isEqual=function(d,i){if(d===i)return true;var m=typeof d;if(m!=typeof i)return false;if(d==i)return true;if(!d&&i||d&&!i)return false;if(d._chain)d=d._wrapped;if(i._chain)i=i._wrapped;if(d.isEqual)return d.isEqual(i);if(i.isEqual)return i.isEqual(d);if(a.isDate(d)&&a.isDate(i))return d.getTime()===i.getTime();
if(a.isNaN(d)&&a.isNaN(i))return false;if(a.isRegExp(d)&&a.isRegExp(i))return d.source===i.source&&d.global===i.global&&d.ignoreCase===i.ignoreCase&&d.multiline===i.multiline;if(m!=="object")return false;if(d.length&&d.length!==i.length)return false;m=a.keys(d);var y=a.keys(i);if(m.length!=y.length)return false;for(var E in d)if(!(E in i)||!a.isEqual(d[E],i[E]))return false;return true};a.isEmpty=function(d){if(a.isArray(d)||a.isString(d))return d.length===0;for(var i in d)if(h.call(d,i))return false;
return true};a.isElement=function(d){return!!(d&&d.nodeType==1)};a.isArray=H||function(d){return w.call(d)==="[object Array]"};a.isObject=function(d){return d===Object(d)};a.isArguments=function(d){return!(!d||!h.call(d,"callee"))};a.isFunction=function(d){return!(!d||!d.constructor||!d.call||!d.apply)};a.isString=function(d){return!!(d===""||d&&d.charCodeAt&&d.substr)};a.isNumber=function(d){return!!(d===0||d&&d.toExponential&&d.toFixed)};a.isNaN=function(d){return d!==d};a.isBoolean=function(d){return d===
true||d===false};a.isDate=function(d){return!(!d||!d.getTimezoneOffset||!d.setUTCFullYear)};a.isRegExp=function(d){return!(!d||!d.test||!d.exec||!(d.ignoreCase||d.ignoreCase===false))};a.isNull=function(d){return d===null};a.isUndefined=function(d){return d===void 0};a.noConflict=function(){r._=F;return this};a.identity=function(d){return d};a.times=function(d,i,m){for(var y=0;y<d;y++)i.call(m,y)};a.mixin=function(d){n(a.functions(d),function(i){G(i,a[i]=d[i])})};var j=0;a.uniqueId=function(d){var i=
j++;return d?d+i:i};a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};a.template=function(d,i){var m=a.templateSettings;m="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+d.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(m.interpolate,function(y,E){return"',"+E.replace(/\\'/g,"'")+",'"}).replace(m.evaluate||null,function(y,E){return"');"+E.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,
"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";m=new Function("obj",m);return i?m(i):m};var u=function(d){this._wrapped=d};a.prototype=u.prototype;var v=function(d,i){return i?a(d).chain():d},G=function(d,i){u.prototype[d]=function(){var m=B.call(arguments);x.call(m,this._wrapped);return v(i.apply(a,m),this._chain)}};a.mixin(a);n(["pop","push","reverse","shift","sort","splice","unshift"],function(d){var i=p[d];u.prototype[d]=function(){i.apply(this._wrapped,arguments);return v(this._wrapped,
this._chain)}});n(["concat","join","slice"],function(d){var i=p[d];u.prototype[d]=function(){return v(i.apply(this._wrapped,arguments),this._chain)}});u.prototype.chain=function(){this._chain=true;return this};u.prototype.value=function(){return this._wrapped}})();/*

 // Backbone.js 0.5.3
 // (c) 2010 Jeremy Ashkenas, DocumentCloud Inc.
 // Backbone may be freely distributed under the MIT license.
 // For all details and documentation:
 // http://documentcloud.github.com/backbone
*/
(function(){var r=this,F=r.Backbone,A;A=typeof exports!=="undefined"?exports:r.Backbone={};A.VERSION="0.5.3";var p=r._;if(!p&&typeof require!=="undefined")p=require("underscore")._;var H=r.jQuery||r.Zepto;A.noConflict=function(){r.Backbone=F;return this};A.emulateHTTP=false;A.emulateJSON=false;A.Events={bind:function(c,a,n){var g=this._callbacks||(this._callbacks={});(g[c]||(g[c]=[])).push([a,n]);return this},unbind:function(c,a){var n;if(c){if(n=this._callbacks)if(a){n=n[c];if(!n)return this;for(var g=
0,l=n.length;g<l;g++)if(n[g]&&a===n[g][0]){n[g]=null;break}}else n[c]=[]}else this._callbacks={};return this},trigger:function(c){var a,n,g,l,j=2;if(!(n=this._callbacks))return this;for(;j--;)if(a=j?c:"all",a=n[a])for(var u=0,v=a.length;u<v;u++)(g=a[u])?(l=j?Array.prototype.slice.call(arguments,1):arguments,g[0].apply(g[1]||this,l)):(a.splice(u,1),u--,v--);return this}};A.Model=function(c,a){var n;c||(c={});if(n=this.defaults){p.isFunction(n)&&(n=n.call(this));c=p.extend({},n,c)}this.attributes={};
this._escapedAttributes={};this.cid=p.uniqueId("c");this.set(c,{silent:true});this._changed=false;this._previousAttributes=p.clone(this.attributes);if(a&&a.collection)this.collection=a.collection;this.initialize(c,a)};p.extend(A.Model.prototype,A.Events,{_previousAttributes:null,_changed:false,idAttribute:"id",initialize:function(){},toJSON:function(){return p.clone(this.attributes)},get:function(c){return this.attributes[c]},escape:function(c){var a;if(a=this._escapedAttributes[c])return a;a=this.attributes[c];
return this._escapedAttributes[c]=(a==null?"":""+a).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},has:function(c){return this.attributes[c]!=null},set:function(c,a){a||(a={});if(!c)return this;if(c.attributes)c=c.attributes;var n=this.attributes,g=this._escapedAttributes;if(!a.silent&&this.validate&&!this._performValidation(c,a))return false;if(this.idAttribute in c)this.id=c[this.idAttribute];
var l=this._changing;this._changing=true;for(var j in c){var u=c[j];if(!p.isEqual(n[j],u)){n[j]=u;delete g[j];this._changed=true;a.silent||this.trigger("change:"+j,this,u,a)}}!l&&!a.silent&&this._changed&&this.change(a);this._changing=false;return this},unset:function(c,a){if(!(c in this.attributes))return this;a||(a={});var n={};n[c]=void 0;if(!a.silent&&this.validate&&!this._performValidation(n,a))return false;delete this.attributes[c];delete this._escapedAttributes[c];c==this.idAttribute&&delete this.id;
this._changed=true;a.silent||(this.trigger("change:"+c,this,void 0,a),this.change(a));return this},clear:function(c){c||(c={});var a,n=this.attributes,g={};for(a in n)g[a]=void 0;if(!c.silent&&this.validate&&!this._performValidation(g,c))return false;this.attributes={};this._escapedAttributes={};this._changed=true;if(!c.silent){for(a in n)this.trigger("change:"+a,this,void 0,c);this.change(c)}return this},fetch:function(c){c||(c={});var a=this,n=c.success;c.success=function(g,l,j){if(!a.set(a.parse(g,
j),c))return false;n&&n(a,g)};c.error=D(c.error,a,c);return(this.sync||A.sync).call(this,"read",this,c)},save:function(c,a){a||(a={});if(c&&!this.set(c,a))return false;var n=this,g=a.success;a.success=function(j,u,v){if(!n.set(n.parse(j,v),a))return false;g&&g(n,j,v)};a.error=D(a.error,n,a);var l=this.isNew()?"create":"update";return(this.sync||A.sync).call(this,l,this,a)},destroy:function(c){c||(c={});if(this.isNew())return this.trigger("destroy",this,this.collection,c);var a=this,n=c.success;c.success=
function(g){a.trigger("destroy",a,a.collection,c);n&&n(a,g)};c.error=D(c.error,a,c);return(this.sync||A.sync).call(this,"delete",this,c)},url:function(){var c=k(this.collection)||this.urlRoot||o();if(this.isNew())return c;return c+(c.charAt(c.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(c){return c},clone:function(){return new this.constructor(this)},isNew:function(){return this.id==null},change:function(c){this.trigger("change",this,c);this._previousAttributes=p.clone(this.attributes);
this._changed=false},hasChanged:function(c){if(c)return this._previousAttributes[c]!=this.attributes[c];return this._changed},changedAttributes:function(c){c||(c=this.attributes);var a=this._previousAttributes,n=false,g;for(g in c)p.isEqual(a[g],c[g])||(n=n||{},n[g]=c[g]);return n},previous:function(c){if(!c||!this._previousAttributes)return null;return this._previousAttributes[c]},previousAttributes:function(){return p.clone(this._previousAttributes)},_performValidation:function(c,a){var n=this.validate(c);
if(n)return a.error?a.error(this,n,a):this.trigger("error",this,n,a),false;return true}});A.Collection=function(c,a){a||(a={});if(a.comparator)this.comparator=a.comparator;p.bindAll(this,"_onModelEvent","_removeReference");this._reset();c&&this.reset(c,{silent:true});this.initialize.apply(this,arguments)};p.extend(A.Collection.prototype,A.Events,{model:A.Model,initialize:function(){},toJSON:function(){return this.map(function(c){return c.toJSON()})},add:function(c,a){if(p.isArray(c))for(var n=0,g=
c.length;n<g;n++)this._add(c[n],a);else this._add(c,a);return this},remove:function(c,a){if(p.isArray(c))for(var n=0,g=c.length;n<g;n++)this._remove(c[n],a);else this._remove(c,a);return this},get:function(c){if(c==null)return null;return this._byId[c.id!=null?c.id:c]},getByCid:function(c){return c&&this._byCid[c.cid||c]},at:function(c){return this.models[c]},sort:function(c){c||(c={});if(!this.comparator)throw Error("Cannot sort a set without a comparator");this.models=this.sortBy(this.comparator);
c.silent||this.trigger("reset",this,c);return this},pluck:function(c){return p.map(this.models,function(a){return a.get(c)})},reset:function(c,a){c||(c=[]);a||(a={});this.each(this._removeReference);this._reset();this.add(c,{silent:true});a.silent||this.trigger("reset",this,a);return this},fetch:function(c){c||(c={});var a=this,n=c.success;c.success=function(g,l,j){a[c.add?"add":"reset"](a.parse(g,j),c);n&&n(a,g)};c.error=D(c.error,a,c);return(this.sync||A.sync).call(this,"read",this,c)},create:function(c,
a){var n=this;a||(a={});c=this._prepareModel(c,a);if(!c)return false;var g=a.success;a.success=function(l,j,u){n.add(l,a);g&&g(l,j,u)};c.save(null,a);return c},parse:function(c){return c},chain:function(){return p(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(c,a){if(c instanceof A.Model){if(!c.collection)c.collection=this}else{var n=c;c=new this.model(n,{collection:this});c.validate&&!c._performValidation(n,a)&&(c=false)}return c},
_add:function(c,a){a||(a={});c=this._prepareModel(c,a);if(!c)return false;var n=this.getByCid(c);if(n)throw Error(["Can't add the same model to a set twice",n.id]);this._byId[c.id]=c;this._byCid[c.cid]=c;this.models.splice(a.at!=null?a.at:this.comparator?this.sortedIndex(c,this.comparator):this.length,0,c);c.bind("all",this._onModelEvent);this.length++;a.silent||c.trigger("add",c,this,a);return c},_remove:function(c,a){a||(a={});c=this.getByCid(c)||this.get(c);if(!c)return null;delete this._byId[c.id];
delete this._byCid[c.cid];this.models.splice(this.indexOf(c),1);this.length--;a.silent||c.trigger("remove",c,this,a);this._removeReference(c);return c},_removeReference:function(c){this==c.collection&&delete c.collection;c.unbind("all",this._onModelEvent)},_onModelEvent:function(c,a,n,g){(c=="add"||c=="remove")&&n!=this||(c=="destroy"&&this._remove(a,g),a&&c==="change:"+a.idAttribute&&(delete this._byId[a.previous(a.idAttribute)],this._byId[a.id]=a),this.trigger.apply(this,arguments))}});p.each(["forEach",
"each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","rest","last","without","indexOf","lastIndexOf","isEmpty","groupBy"],function(c){A.Collection.prototype[c]=function(){return p[c].apply(p,[this.models].concat(p.toArray(arguments)))}});A.Router=function(c){c||(c={});if(c.routes)this.routes=c.routes;this._bindRoutes();this.initialize.apply(this,arguments)};
var B=/:([\w\d]+)/g,x=/\*([\w\d]+)/g,w=/[-[\]{}()+?.,\\^$|#\s]/g;p.extend(A.Router.prototype,A.Events,{initialize:function(){},route:function(c,a,n){A.history||(A.history=new A.History);p.isRegExp(c)||(c=this._routeToRegExp(c));A.history.route(c,p.bind(function(g){g=this._extractParameters(c,g);n.apply(this,g);this.trigger.apply(this,["route:"+a].concat(g))},this))},navigate:function(c,a){A.history.navigate(c,a)},_bindRoutes:function(){if(this.routes){var c=[],a;for(a in this.routes)c.unshift([a,
this.routes[a]]);a=0;for(var n=c.length;a<n;a++)this.route(c[a][0],c[a][1],this[c[a][1]])}},_routeToRegExp:function(c){c=c.replace(w,"\\$&").replace(B,"([^/]*)").replace(x,"(.*?)");return RegExp("^"+c+"$")},_extractParameters:function(c,a){return c.exec(a).slice(1)}});A.History=function(){this.handlers=[];p.bindAll(this,"checkUrl")};var h=/^#*/,I=/msie [\w.]+/,C=false;p.extend(A.History.prototype,{interval:50,getFragment:function(c,a){if(c==null)if(this._hasPushState||a){c=window.location.pathname;
var n=window.location.search;n&&(c+=n);c.indexOf(this.options.root)==0&&(c=c.substr(this.options.root.length))}else c=window.location.hash;return decodeURIComponent(c.replace(h,""))},start:function(c){if(C)throw Error("Backbone.history has already been started");this.options=p.extend({},{root:"/"},this.options,c);this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);c=this.getFragment();var a=document.documentMode;if(a=
I.exec(navigator.userAgent.toLowerCase())&&(!a||a<=7)){this.iframe=H('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(c)}this._hasPushState?H(window).bind("popstate",this.checkUrl):"onhashchange"in window&&!a?H(window).bind("hashchange",this.checkUrl):setInterval(this.checkUrl,this.interval);this.fragment=c;C=true;c=window.location;a=c.pathname==this.options.root;if(this._wantsPushState&&!this._hasPushState&&!a)return this.fragment=this.getFragment(null,
true),window.location.replace(this.options.root+"#"+this.fragment),true;else if(this._wantsPushState&&this._hasPushState&&a&&c.hash){this.fragment=c.hash.replace(h,"");window.history.replaceState({},document.title,c.protocol+"//"+c.host+this.options.root+this.fragment)}if(!this.options.silent)return this.loadUrl()},route:function(c,a){this.handlers.unshift({route:c,callback:a})},checkUrl:function(){var c=this.getFragment();c==this.fragment&&this.iframe&&(c=this.getFragment(this.iframe.location.hash));
if(c==this.fragment||c==decodeURIComponent(this.fragment))return false;this.iframe&&this.navigate(c);this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(c){var a=this.fragment=this.getFragment(c);return p.any(this.handlers,function(n){if(n.route.test(a))return n.callback(a),true})},navigate:function(c,a){var n=(c||"").replace(h,"");if(!(this.fragment==n||this.fragment==decodeURIComponent(n))){if(this._hasPushState){var g=window.location;n.indexOf(this.options.root)!=0&&(n=this.options.root+
n);this.fragment=n;window.history.pushState({},document.title,g.protocol+"//"+g.host+n)}else if(window.location.hash=this.fragment=n,this.iframe&&n!=this.getFragment(this.iframe.location.hash)){this.iframe.document.open().close();this.iframe.location.hash=n}a&&this.loadUrl(c)}}});A.View=function(c){this.cid=p.uniqueId("view");this._configure(c||{});this._ensureElement();this.delegateEvents();this.initialize.apply(this,arguments)};var e=/^(\S+)\s*(.*)$/,q=["model","collection","el","id","attributes",
"className","tagName"];p.extend(A.View.prototype,A.Events,{tagName:"div",$:function(c){return H(c,this.el)},initialize:function(){},render:function(){return this},remove:function(){H(this.el).remove();return this},make:function(c,a,n){c=document.createElement(c);a&&H(c).attr(a);n&&H(c).html(n);return c},delegateEvents:function(c){if(c||(c=this.events))for(var a in p.isFunction(c)&&(c=c.call(this)),H(this.el).unbind(".delegateEvents"+this.cid),c){var n=this[c[a]];if(!n)throw Error('Event "'+c[a]+'" does not exist');
var g=a.match(e),l=g[1];g=g[2];n=p.bind(n,this);l+=".delegateEvents"+this.cid;g===""?H(this.el).bind(l,n):H(this.el).delegate(g,l,n)}},_configure:function(c){this.options&&(c=p.extend({},this.options,c));for(var a=0,n=q.length;a<n;a++){var g=q[a];c[g]&&(this[g]=c[g])}this.options=c},_ensureElement:function(){if(this.el){if(p.isString(this.el))this.el=H(this.el).get(0)}else{var c=this.attributes||{};if(this.id)c.id=this.id;if(this.className)c["class"]=this.className;this.el=this.make(this.tagName,
c)}}});A.Model.extend=A.Collection.extend=A.Router.extend=A.View.extend=function(c,a){var n=f(this,c,a);n.extend=this.extend;return n};var s={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};A.sync=function(c,a,n){var g=s[c];n=p.extend({type:g,dataType:"json"},n);if(!n.url)n.url=k(a)||o();if(!n.data&&a&&(c=="create"||c=="update")){n.contentType="application/json";n.data=JSON.stringify(a.toJSON())}if(A.emulateJSON){n.contentType="application/x-www-form-urlencoded";n.data=n.data?{model:n.data}:
{}}if(A.emulateHTTP&&(g==="PUT"||g==="DELETE")){if(A.emulateJSON)n.data._method=g;n.type="POST";n.beforeSend=function(l){l.setRequestHeader("X-HTTP-Method-Override",g)}}if(n.type!=="GET"&&!A.emulateJSON)n.processData=false;return H.ajax(n)};var z=function(){},f=function(c,a,n){var g;g=a&&a.hasOwnProperty("constructor")?a.constructor:function(){return c.apply(this,arguments)};p.extend(g,c);z.prototype=c.prototype;g.prototype=new z;a&&p.extend(g.prototype,a);n&&p.extend(g,n);g.prototype.constructor=
g;g.__super__=c.prototype;return g},k=function(c){if(!c||!c.url)return null;return p.isFunction(c.url)?c.url():c.url},o=function(){throw Error('A "url" property or function must be specified');},D=function(c,a,n){return function(g){c?c(a,g,n):a.trigger("error",a,g,n)}}}).call(this);/*

 jQuery Templates Plugin 1.0.0pre
 http://github.com/jquery/jquery-tmpl
 Requires jQuery 1.4.2

 Copyright Software Freedom Conservancy, Inc.
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://jquery.org/license
*/
(function(r){function F(l,j,u,v){v={data:v||v===0||v===false?v:j?j.data:{},_wrap:j?j._wrap:null,tmpl:null,parent:j||null,nodes:[],calls:h,nest:I,wrap:C,html:e,update:q};l&&r.extend(v,l,{nodes:[],parent:j});if(u){v.tmpl=u;v._ctnt=v._ctnt||v.tmpl(r,v);v.key=++a;(g.length?o:k)[a]=v}return v}function A(l,j,u){var v;u=u?r.map(u,function(G){return typeof G==="string"?l.key?G.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+z+'="'+l.key+'" $2'):G:A(G,l,G._ctnt)}):l;if(j)return u;u=u.join("");u.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(G,d,i,m){v=r(i).get();w(v);if(d)v=p(d).concat(v);if(m)v=v.concat(p(m))});return v?v:p(u)}function p(l){var j=document.createElement("div");j.innerHTML=l;return r.makeArray(j.childNodes)}function H(l){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+r.trim(l).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(j,u,v,G,d,i,m){j=r.tmpl.tag[v];if(!j)throw"Unknown template tag: "+v;v=j._default||[];if(i&&!/\w$/.test(d)){d+=i;i=""}if(d){d=x(d);m=m?","+x(m)+")":i?")":"";m=i?d.indexOf(".")>-1?d+x(i):"("+d+").call($item"+m:d;i=i?m:"(typeof("+d+")==='function'?("+d+").call($item):("+d+"))"}else i=m=v.$1||"null";G=x(G);return"');"+j[u?"close":"open"].split("$notnull_1").join(d?"typeof("+d+")!=='undefined' && ("+d+")!=null":"true").split("$1a").join(i).split("$1").join(m).split("$2").join(G||v.$2||"")+"__.push('"})+
"');}return __;")}function B(l,j){l._wrap=A(l,true,r.isArray(j)?j:[f.test(j)?j:r(j).html()]).join("")}function x(l){return l?l.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function w(l){function j(E){function J(P){P+=u;K=d[P]=d[P]||F(K,k[K.parent.key+u]||K.parent)}var L,O=E,K,Q;if(Q=E.getAttribute(z)){for(;O.parentNode&&(O=O.parentNode).nodeType===1&&!(L=O.getAttribute(z)););if(L!==Q){O=O.parentNode?O.nodeType===11?0:O.getAttribute(z)||0:0;if(!(K=k[Q])){K=o[Q];K=F(K,k[O]||o[O]);K.key=++a;k[a]=K}n&&
J(Q)}E.removeAttribute(z)}else if(n&&(K=r.data(E,"tmplItem"))){J(K.key);k[K.key]=K;O=(O=r.data(E.parentNode,"tmplItem"))?O.key:0}if(K){for(L=K;L&&L.key!=O;){L.nodes.push(E);L=L.parent}delete K._ctnt;delete K._wrap;r.data(E,"tmplItem",K)}}var u="_"+n,v,G,d={},i,m,y;i=0;for(m=l.length;i<m;i++)if((v=l[i]).nodeType===1){G=v.getElementsByTagName("*");for(y=G.length-1;y>=0;y--)j(G[y]);j(v)}}function h(l,j,u,v){if(!l)return g.pop();g.push({_:l,tmpl:j,item:this,data:u,options:v})}function I(l,j,u){return r.tmpl(r.template(l),
j,u,this)}function C(l,j){var u=l.options||{};u.wrapped=j;return r.tmpl(r.template(l.tmpl),l.data,u,l.item)}function e(l,j){var u=this._wrap;return r.map(r(r.isArray(u)?u.join(""):u).filter(l||"*"),function(v){if(j)v=v.innerText||v.textContent;else{var G;if(!(G=v.outerHTML)){G=document.createElement("div");G.appendChild(v.cloneNode(true));G=G.innerHTML}v=G}return v})}function q(){var l=this.nodes;r.tmpl(null,null,null,this).insertBefore(l[0]);r(l).remove()}var s=r.fn.domManip,z="_tmplitem",f=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,
k={},o={},D,c={key:0,data:{}},a=0,n=0,g=[];r.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(l,j){r.fn[l]=function(u){var v=[];u=r(u);var G,d,i;G=this.length===1&&this[0].parentNode;D=k||{};if(G&&G.nodeType===11&&G.childNodes.length===1&&u.length===1){u[j](this[0]);v=this}else{d=0;for(i=u.length;d<i;d++){n=d;G=(d>0?this.clone(true):this).get();r(u[d])[j](G);v=v.concat(G)}n=0;v=this.pushStack(v,l,u.selector)}u=D;D=null;r.tmpl.complete(u);
return v}});r.fn.extend({tmpl:function(l,j,u){return r.tmpl(this[0],l,j,u)},tmplItem:function(){return r.tmplItem(this[0])},template:function(l){return r.template(l,this[0])},domManip:function(l,j,u){if(l[0]&&r.isArray(l[0])){for(var v=r.makeArray(arguments),G=l[0],d=G.length,i=0,m;i<d&&!(m=r.data(G[i++],"tmplItem")););if(m&&n)v[2]=function(y){r.tmpl.afterManip(this,y,u)};s.apply(this,v)}else s.apply(this,arguments);n=0;D||r.tmpl.complete(k);return this}});r.extend({tmpl:function(l,j,u,v){var G=!v;
if(G){v=c;l=r.template[l]||r.template(null,l);o={}}else if(!l){l=v.tmpl;k[v.key]=v;v.nodes=[];v.wrapped&&B(v,v.wrapped);return r(A(v,null,v.tmpl(r,v)))}if(!l)return[];if(typeof j==="function")j=j.call(v||{});u&&u.wrapped&&B(u,u.wrapped);j=r.isArray(j)?r.map(j,function(d){return d?F(u,v,l,d):null}):[F(u,v,l,j)];return G?r(A(v,null,j)):j},tmplItem:function(l){var j;if(l instanceof r)l=l[0];for(;l&&l.nodeType===1&&!(j=r.data(l,"tmplItem"))&&(l=l.parentNode););return j||c},template:function(l,j){if(j){if(typeof j===
"string")j=H(j);else if(j instanceof r)j=j[0]||{};if(j.nodeType)j=r.data(j,"tmpl")||r.data(j,"tmpl",H(j.innerHTML));return typeof l==="string"?r.template[l]=j:j}return l?typeof l!=="string"?r.template(null,l):r.template[l]||r.template(null,f.test(l)?l:r(l)):null},encode:function(l){return(""+l).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});r.extend(r.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},
wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){k=
{}},afterManip:function(l,j,u){var v=j.nodeType===11?r.makeArray(j.childNodes):j.nodeType===1?[j]:[];u.call(l,j);w(v);n++}})})(jQuery);/*
 
 JavaScript Debug - v0.4 - 6/22/2010
 http://benalman.com/projects/javascript-debug-console-log/

 Copyright (c) 2010 "Cowboy" Ben Alman
 Dual licensed under the MIT and GPL licenses.
 http://benalman.com/about/license/

 With lots of help from Paul Irish!
 http://paulirish.com/
*/
window.debug=function(){function r(q){if(B&&(x||!p||!p.log))B.apply(F,q)}for(var F=this,A=Array.prototype.slice,p=F.console,H={},B,x,w=9,h=["error","warn","info","debug","log"],I="assert clear count dir dirxml exception group groupCollapsed groupEnd profile profileEnd table time timeEnd trace".split(" "),C=I.length,e=[];--C>=0;)(function(q){H[q]=function(){w!==0&&p&&p[q]&&p[q].apply(p,arguments)}})(I[C]);for(C=h.length;--C>=0;)(function(q,s){H[s]=function(){var z=A.call(arguments),f=[s].concat(z);
e.push(f);r(f);if(p&&(w>0?w>q:h.length+w<=q))p.firebug?p[s].apply(F,z):p[s]?p[s](z):p.log(z)}})(C,h[C]);H.setLevel=function(q){w=typeof q==="number"?q:9};H.setCallback=function(){var q=A.call(arguments),s=e.length,z=s;B=q.shift()||null;x=typeof q[0]==="boolean"?q.shift():false;for(z-=typeof q[0]==="number"?q.shift():s;z<s;)r(e[z++])};return H}();(function(r){var F=r("<b/>");r.subscribe=function(A,p){function H(){return p.apply(this,Array.prototype.slice.call(arguments,1))}H.guid=p.guid=p.guid||(r.guid?r.guid++:r.event.guid++);F.bind(A,H)};r.unsubscribe=function(){F.unbind.apply(F,arguments)};r.publish=function(){F.trigger.apply(F,arguments)}})(jQuery);(function(r){function F(H){var B=H||window.event,x=[].slice.call(arguments,1),w=0,h=0,I=0;return H=r.event.fix(B),H.type="mousewheel",B.detail&&(w=-B.detail/3),B.wheelDeltaY!==undefined&&(I=B.wheelDeltaY/120),B.wheelDeltaX!==undefined&&(h=-1*B.wheelDeltaX/120),x.unshift(H,w,h,I),(r.event.dispatch||r.event.handle).apply(this,x)}var A=["DOMMouseScroll","mousewheel"];if(r.event.fixHooks)for(var p=A.length;p;)r.event.fixHooks[A[--p]]=r.event.mouseHooks;r.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var H=
A.length;H;)this.addEventListener(A[--H],F,false);else this.onmousewheel=F},teardown:function(){if(this.removeEventListener)for(var H=A.length;H;)this.removeEventListener(A[--H],F,false);else this.onmousewheel=null}};r.fn.extend({mousewheel:function(H){return H?this.bind("mousewheel",H):this.trigger("mousewheel")},unmousewheel:function(H){return this.unbind("mousewheel",H)}})})(jQuery);$(function(){$.extend($.support,{touch:"ontouchend"in document});$.fn.addTouch=function(){$.support.touch&&this.each(function(r,F){F.addEventListener("touchstart",iPadTouchHandler,false);F.addEventListener("touchmove",iPadTouchHandler,false);F.addEventListener("touchend",iPadTouchHandler,false);F.addEventListener("touchcancel",iPadTouchHandler,false)})}});var lastTap=null,tapValid=false,tapTimeout=null;function cancelTap(){tapValid=false}
var rightClickPending=false,rightClickEvent=null,holdTimeout=null,cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(r){if(!rightClickPending){rightClickPending=true;rightClickEvent=r.changedTouches[0];holdTimeout=window.setTimeout("doRightClick();",800)}}
function doRightClick(){rightClickPending=false;var r=rightClickEvent,F=document.createEvent("MouseEvent");F.initMouseEvent("mouseup",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(F);F=document.createEvent("MouseEvent");F.initMouseEvent("mousedown",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,2,null);r.target.dispatchEvent(F);F=document.createEvent("MouseEvent");F.initMouseEvent("contextmenu",
true,true,window,1,r.screenX+50,r.screenY+5,r.clientX+50,r.clientY+5,false,false,false,false,2,null);r.target.dispatchEvent(F);cancelMouseUp=true;rightClickEvent=null}
function iPadTouchStart(r){var F=r.changedTouches[0],A="mouseover",p=document.createEvent("MouseEvent");p.initMouseEvent(A,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(p);A="mousedown";p=document.createEvent("MouseEvent");p.initMouseEvent(A,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(p);if(tapValid){window.clearTimeout(tapTimeout);if(F.target==lastTap){lastTap=
null;tapValid=false;A="click";p=document.createEvent("MouseEvent");p.initMouseEvent(A,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(p);A="dblclick";p=document.createEvent("MouseEvent");p.initMouseEvent(A,true,true,window,1,F.screenX,F.screenY,F.clientX,F.clientY,false,false,false,false,0,null);F.target.dispatchEvent(p)}else{lastTap=F.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(r)}}else{lastTap=
F.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(r)}}
function iPadTouchHandler(r){var F="";if(!(r.touches.length>1)){switch(r.type){case "touchstart":if($(r.changedTouches[0].target).is("select"))return;iPadTouchStart(r);r.preventDefault();return false;case "touchmove":cancelHold();F="mousemove";r.preventDefault();break;case "touchend":if(cancelMouseUp){cancelMouseUp=false;r.preventDefault();return false}cancelHold();F="mouseup";break;default:return}r=r.changedTouches[0];var A=document.createEvent("MouseEvent");A.initMouseEvent(F,true,true,window,1,
r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(A);if(F=="mouseup"&&tapValid&&r.target==lastTap){A=document.createEvent("MouseEvent");A.initMouseEvent("click",true,true,window,1,r.screenX,r.screenY,r.clientX,r.clientY,false,false,false,false,0,null);r.target.dispatchEvent(A)}}};(function(){function r(g){return(g+"").replace(o,"")}function F(g,l,j){for(var u=g.length;u<l;u++)g=j?"0"+g:g+"0";return g}function A(g){return n.call(g)==="[object Array]"}function p(g,l){if(g.indexOf)return g.indexOf(l);for(var j=0,u=g.length;j<u;j++)if(g[j]===l)return j;return-1}function H(g,l,j){var u=l["-"];l=l["+"];var v;switch(j){case "n -":u=" "+u;l=" "+l;case "n-":if(g.substr(g.length-u.length)===u)v=["-",g.substr(0,g.length-u.length)];else if(g.substr(g.length-l.length)===l)v=["+",g.substr(0,
g.length-l.length)];break;case "- n":u+=" ";l+=" ";case "-n":if(g.indexOf(u)===0)v=["-",g.substr(u.length)];else if(g.indexOf(l)===0)v=["+",g.substr(l.length)];break;case "(n)":if(g.indexOf("(")===0&&g.substr(g.length-1)===")")v=["-",g.substr(1,g.length-2)]}return v||["",g]}function B(g,l){if(!l)return 0;for(var j,u=g.getTime(),v=0,G=l.length;v<G;v++){j=l[v].start;if(j===null||u>=j)return v}return 0}function x(g){return g.split("\u00a0").join(" ").toUpperCase()}function w(g){for(var l=[],j=0,u=g.length;j<
u;j++)l[j]=x(g[j]);return l}function h(g,l,j,u){g=g.getFullYear();if(!u&&l.eras)g-=l.eras[j].offset;return g}function I(g,l){for(var j=0,u=false,v=0,G=g.length;v<G;v++){var d=g.charAt(v);switch(d){case "'":if(u)l.push("'");else j++;u=false;break;case "\\":u&&l.push("\\");u=!u;break;default:l.push(d);u=false}}return j}function C(g,l){l=l||"F";var j;j=g.patterns;var u=l.length;if(u===1){j=j[l];if(!j)throw"Invalid date format string '"+l+"'.";l=j}else if(u===2&&l.charAt(0)==="%")l=l.charAt(1);return l}
function e(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g}function q(g,l,j){g=r(g);j=j.calendar;a:{var u=j._parseRegExp;if(u){var v=u[l];if(v){l=v;break a}}else j._parseRegExp=u={};v=C(j,l).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1");for(var G=["^"],d=[],i=0,m=0,y=e(),E;(E=y.exec(v))!==null;){var J=v.slice(i,E.index);i=y.lastIndex;m+=I(J,G);if(m%2)G.push(E[0]);else{J=E[0];var L=J.length;switch(J){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":J=
"(\\D+)";break;case "tt":case "t":J="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":J="(\\d{"+L+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":J="(\\d\\d?)";break;case "zzz":J="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":J="([+-]?\\d\\d?)";break;case "/":J="(\\"+j["/"]+")";break;default:throw"Invalid date format pattern '"+J+"'.";}J&&G.push(J);d.push(E[0])}}I(v.slice(i),G);G.push("$");v={regExp:G.join("").replace(/\s+/g,
"\\s+"),groups:d};l=u[l]=v}m=RegExp(l.regExp).exec(g);if(m===null)return null;y=l.groups;var O=g=null,K=null,Q=l=null;d=G=v=u=0;E=null;i=false;J=0;for(L=y.length;J<L;J++){var P=m[J+1];if(P){var R=y[J],M=R.length,N=parseInt(P,10);switch(R){case "dd":case "d":l=N;if(l<1||l>31)return null;break;case "MMM":case "MMMM":K=j;M=M===3;R=K.months;var S=K.monthsGenitive||K.months,T=K._upperMonths;N=K._upperMonthsGen;if(!T){K._upperMonths=T=[w(R.names),w(R.namesAbbr)];K._upperMonthsGen=N=[w(S.names),w(S.namesAbbr)]}P=
x(P);K=p(M?T[1]:T[0],P);if(K<0)K=p(M?N[1]:N[0],P);if(K<0||K>11)return null;break;case "M":case "MM":K=N-1;if(K<0||K>11)return null;break;case "y":case "yy":case "yyyy":if(M<4){O=j;P=N;N=new Date;R=B(N);if(P<100){M=O.twoDigitYearMax;M=typeof M==="string"?(new Date).getFullYear()%100+parseInt(M,10):M;O=h(N,O,R);P+=O-O%100;if(P>M)P-=100}O=P}else O=N;if(O<0||O>9999)return null;break;case "h":case "hh":u=N;if(u===12)u=0;if(u<0||u>11)return null;break;case "H":case "HH":u=N;if(u<0||u>23)return null;break;
case "m":case "mm":v=N;if(v<0||v>59)return null;break;case "s":case "ss":G=N;if(G<0||G>59)return null;break;case "tt":case "t":i=j.PM&&(P===j.PM[0]||P===j.PM[1]||P===j.PM[2]);if(!i&&(!j.AM||P!==j.AM[0]&&P!==j.AM[1]&&P!==j.AM[2]))return null;break;case "f":case "ff":case "fff":d=N*Math.pow(10,3-M);if(d<0||d>999)return null;break;case "ddd":case "dddd":Q=P;P=M===3;N=void 0;N=j.days;M=j._upperDays;if(!M)j._upperDays=M=[w(N.names),w(N.namesAbbr),w(N.namesShort)];Q=x(Q);if(P){N=p(M[1],Q);if(N===-1)N=p(M[2],
Q)}else N=p(M[0],Q);Q=N;if(Q<0||Q>6)return null;break;case "zzz":M=P.split(/:/);if(M.length!==2)return null;E=parseInt(M[0],10);if(E<-12||E>13)return null;M=parseInt(M[1],10);if(M<0||M>59)return null;E=E*60+(P.indexOf("-")===0?-M:M);break;case "z":case "zz":E=N;if(E<-12||E>13)return null;E*=60;break;case "g":case "gg":if(!P||!j.eras)return null;P=r(P.toLowerCase());M=0;for(N=j.eras.length;M<N;M++)if(P===j.eras[M].name.toLowerCase()){g=M;break}if(g===null)return null}}}m=new Date;y=(J=j.convert)?J.fromGregorian(m)[0]:
m.getFullYear();if(O===null)O=y;else if(j.eras)O+=j.eras[g||0].offset;if(K===null)K=0;if(l===null)l=1;if(J){m=J.toGregorian(O,K,l);if(m===null)return null}else{m.setFullYear(O,K,l);if(m.getDate()!==l)return null;if(Q!==null&&m.getDay()!==Q)return null}if(i&&u<12)u+=12;m.setHours(u,v,G,d);if(E!==null){j=m.getMinutes()-(E+m.getTimezoneOffset());m.setHours(m.getHours()+parseInt(j/60,10),j%60)}return m}function s(g,l,j){function u(M,N){var S;S=M+"";if(N>1&&S.length<N){S=J[N-2]+S;return S.substr(S.length-
N,N)}return S}function v(){if(L||O)return L;L=K.test(l);O=true;return L}function G(M,N){if(R)return R[N];switch(N){case 0:return M.getFullYear();case 1:return M.getMonth();case 2:return M.getDate()}}var d=j.calendar,i=d.convert;if(!l||!l.length||l==="i"){if(j&&j.name.length)if(i)j=s(g,d.patterns.F,j);else{j=new Date(g.getTime());var m=B(g,d.eras);j.setFullYear(h(g,d,m));j=j.toLocaleString()}else j=g.toString();return j}m=d.eras;var y=l==="s";l=C(d,l);j=[];var E,J=["0","00","000"],L,O,K=/([^d]|^)(d|dd)([^d]|$)/g,
Q=0,P=e(),R;if(!y&&i)R=i.fromGregorian(g);for(;;){E=P.lastIndex;i=P.exec(l);E=l.slice(E,i?i.index:l.length);Q+=I(E,j);if(!i)break;if(Q%2)j.push(i[0]);else{E=i[0];i=E.length;switch(E){case "ddd":case "dddd":j.push((i===3?d.days.namesAbbr:d.days.names)[g.getDay()]);break;case "d":case "dd":L=true;j.push(u(G(g,2),i));break;case "MMM":case "MMMM":E=G(g,1);j.push(d.monthsGenitive&&v()?d.monthsGenitive[i===3?"namesAbbr":"names"][E]:d.months[i===3?"namesAbbr":"names"][E]);break;case "M":case "MM":j.push(u(G(g,
1)+1,i));break;case "y":case "yy":case "yyyy":E=R?R[0]:h(g,d,B(g,m),y);if(i<4)E%=100;j.push(u(E,i));break;case "h":case "hh":E=g.getHours()%12;if(E===0)E=12;j.push(u(E,i));break;case "H":case "HH":j.push(u(g.getHours(),i));break;case "m":case "mm":j.push(u(g.getMinutes(),i));break;case "s":case "ss":j.push(u(g.getSeconds(),i));break;case "t":case "tt":E=g.getHours()<12?d.AM?d.AM[0]:" ":d.PM?d.PM[0]:" ";j.push(i===1?E.charAt(0):E);break;case "f":case "ff":case "fff":j.push(u(g.getMilliseconds(),3).substr(0,
i));break;case "z":case "zz":E=g.getTimezoneOffset()/60;j.push((E<=0?"+":"-")+u(Math.floor(Math.abs(E)),i));break;case "zzz":E=g.getTimezoneOffset()/60;j.push((E<=0?"+":"-")+u(Math.floor(Math.abs(E)),2)+":"+u(Math.abs(g.getTimezoneOffset()%60),2));break;case "g":case "gg":d.eras&&j.push(d.eras[B(g,m)].name);break;case "/":j.push(d["/"]);break;default:throw"Invalid date format pattern '"+E+"'.";}}}return j.join("")}var z={},f={en:{}};f["default"]=f.en;z.extend=function(g){for(var l=arguments[1]||{},
j=2,u=arguments.length;j<u;j++){var v=arguments[j];if(v)for(var G in v){var d=v[G];if(typeof d!=="undefined")if(g&&(n.call(d)==="[object Object]"||A(d))){var i=l[G];i=i&&(n.call(i)==="[object Object]"||A(i))?i:A(d)?[]:{};l[G]=this.extend(true,i,d)}else l[G]=d}}return l};z.findClosestCulture=function(g){var l;if(!g)return this.culture||this.cultures["default"];if(n.call(g)==="[object String]")g=g.split(",");if(A(g)){var j,u=this.cultures,v=g,G,d=v.length,i=[];for(G=0;G<d;G++){g=r(v[G]);g=g.split(";");
j=r(g[0]);if(g.length===1)g=1;else{g=r(g[1]);if(g.indexOf("q=")===0){g=g.substr(2);g=parseFloat(g,10);g=isNaN(g)?0:g}else g=1}i.push({lang:j,pri:g})}i.sort(function(y,E){return y.pri<E.pri?1:-1});for(G=0;G<d;G++){j=i[G].lang;if(l=u[j])return l}for(G=0;G<d;G++){j=i[G].lang;do{v=j.lastIndexOf("-");if(v===-1)break;j=j.substr(0,v);if(l=u[j])return l}while(1)}for(G=0;G<d;G++){j=i[G].lang;for(var m in u){v=u[m];if(v.language==j)return v}}}else if(typeof g==="object")return g;return l||null};z.preferCulture=
function(g){this.culture=this.findClosestCulture(g)||this.cultures["default"]};z.localize=function(g,l,j){if(typeof l!=="string")l=this.culture.name||this.culture||"default";l=this.cultures[l]||{name:l};var u=f[l.name];if(arguments.length===3){u||(u=f[l.name]={});u[g]=j}else{if(u)j=u[g];if(typeof j==="undefined"){if(u=f[l.language])j=u[g];if(typeof j==="undefined")j=f["default"][g]}}return typeof j==="undefined"?null:j};z.format=function(g,l,j){j=this.findClosestCulture(j);if(typeof g==="number"){var u=
g;if(!l||l==="i")g=j.name.length?u.toLocaleString():u.toString();else{l=l||"D";j=j.numberFormat;g=Math.abs(u);var v=-1;if(l.length>1)v=parseInt(l.slice(1),10);var G=l.charAt(0).toUpperCase(),d;switch(G){case "D":l="n";if(v!==-1)g=F(""+g,v,true);if(u<0)g=-g;break;case "N":d=j;case "C":d=d||j.currency;case "P":d=d||j.percent;l=u<0?d.pattern[0]:d.pattern[1]||"n";if(v===-1)v=d.decimals;b:{var i=g*(G==="P"?100:1);G=d;d=G.groupSizes;g=d[0];u=1;var m=Math.pow(10,v),y=Math.round(i*m)/m;isFinite(y)||(y=i);
m="";m=(y+"").split(/e/i);y=m.length>1?parseInt(m[1],10):0;i=m[0];m=i.split(".");i=m[0];m=m.length>1?m[1]:"";if(y>0){m=F(m,y,false);i+=m.slice(0,y);m=m.substr(y)}else if(y<0){y=-y;i=F(i,y+1);m=i.slice(-y,i.length)+m;i=i.slice(0,-y)}m=v>0?G["."]+(m.length>v?m.slice(0,v):F(m,v)):"";v=i.length-1;G=G[","];for(y="";v>=0;){if(g===0||g>v){g=i.slice(0,v+1)+(y.length?G+y+m:m);break b}y=i.slice(v-g+1,v+1)+(y.length?G+y:"");v-=g;if(u<d.length){g=d[u];u++}}g=i.slice(0,v+1)+G+y+m}break;default:throw"Bad number format specifier: "+
G;}d=/n|\$|-|%/g;for(u="";;){v=d.lastIndex;G=d.exec(l);u+=l.slice(v,G?G.index:l.length);if(!G)break;switch(G[0]){case "n":u+=g;break;case "$":u+=j.currency.symbol;break;case "-":if(/[1-9]/.test(g))u+=j["-"];break;case "%":u+=j.percent.symbol}}g=u}}else if(g instanceof Date)g=s(g,l,j);return g};z.parseInt=function(g,l,j){return Math.floor(this.parseFloat(g,l,j))};z.parseFloat=function(g,l,j){if(typeof l==="string"){j=l;l=10}j=this.findClosestCulture(j);var u=NaN,v=j.numberFormat;if(g.indexOf(j.numberFormat.currency.symbol)>
-1){g=g.replace(j.numberFormat.currency.symbol,"");g=g.replace(j.numberFormat.currency["."],j.numberFormat["."])}g=r(g);if(D.test(g))u=parseFloat(g,l);else if(!l&&c.test(g))u=parseInt(g,16);else{j=H(g,v,v.pattern[0]);l=j[0];j=j[1];if(l===""&&v.pattern[0]!=="-n"){j=H(g,v,"-n");l=j[0];j=j[1]}l=l||"+";var G;g=j.indexOf("e");if(g<0)g=j.indexOf("E");if(g<0){G=j;g=null}else{G=j.substr(0,g);g=j.substr(g+1)}var d=v["."],i=G.indexOf(d);if(i<0){j=G;G=null}else{j=G.substr(0,i);G=G.substr(i+d.length)}d=v[","];
j=j.split(d).join("");i=d.replace(/\u00A0/g," ");if(d!==i)j=j.split(i).join("");l+=j;if(G!==null)l+="."+G;if(g!==null){v=H(g,v,"-n");l+="e"+(v[0]||"+")+v[1]}if(a.test(l))u=parseFloat(l)}return u};z.parseDate=function(g,l,j){j=this.findClosestCulture(j);var u,v;if(l){if(typeof l==="string")l=[l];if(l.length){v=0;for(var G=l.length;v<G;v++){var d=l[v];if(d)if(u=q(g,d,j))break}}}else{l=j.calendar.patterns;for(v in l)if(u=q(g,l[v],j))break}return u||null};var k=z.cultures=z.cultures||{};k=k["default"]=
k.en=z.extend(true,{name:"en",englishName:"English",nativeName:"English",isRTL:false,language:"en",numberFormat:{pattern:["-n"],decimals:2,",":",",".":".",groupSizes:[3],"+":"+","-":"-",percent:{pattern:["-n %","n %"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"%"},currency:{pattern:["($n)","$n"],decimals:2,groupSizes:[3],",":",",".":".",symbol:"$"}},calendars:{standard:{name:"Gregorian_USEnglish","/":"/",":":":",firstDay:0,days:{names:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday",
"Saturday"],namesAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],namesShort:["Su","Mo","Tu","We","Th","Fr","Sa"]},months:{names:["January","February","March","April","May","June","July","August","September","October","November","December",""],namesAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",
f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss"}}}},k.en);k.calendar=k.calendar||k.calendars.standard;var o=/^\s+|\s+$/g,D=/^[+-]?infinity$/i,c=/^0x[a-f0-9]+$/i,a=/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,n=Object.prototype.toString;jQuery.global=z})();timeglider=window.timeglider||{version:"0.1.0"};timeglider.TG_Date={};
(function(r){function F(e){return parseInt(e,10)}function A(e){var q=parseInt(e,10);return q>9||q<0?String(e):"0"+q}r=timeglider;var p=jQuery,H={},B={},x={},w={},h={},I=/^(\-?\d+)?(\-\d{1,2})?(\-\d{1,2})?(?:T| )?(\d{1,2})?(?::)?(\d{1,2})?(?::)?(\d{1,2})?(\+|\-)?(\d{1,2})?(?::)?(\d{1,2})?/;r.TG_Date=function(e,q,s){var z,f,k;s=s||0;if(typeof e=="number"){z=f=C.getDateFromSec(e);k=e+s}else if(typeof e!=="object"){if(e=="today")e=C.getToday();z=f=e}if(I.test(z)){e=C.parse8601(z);if(e.tz_ho)e=C.toFromUTC(e,
{hours:e.tz_ho,minutes:e.tz_mi},"to");p.extend(this,e);this.rd=C.getRataDie(this);this.mo_num=this.ye>0?(this.ye-1)*12+this.mo:-1*((Math.abs(this.ye)-1)*12+(12-(this.mo-1)));if(!k){k=Math.abs(this.rd)*86400;e=this.ho*3600;z=(this.mi-1)*60;s=1;if(this.rd<0)s=-1;k=s*(k+e+z)}this.sec=k;this.date_display=q?q.toLowerCase().substr(0,2):"da";this.dateStr=f}else return{error:"invalid date"};return this};var C=r.TG_Date;C.getTimeUnitSerial=function(e,q){var s=0;switch(q){case "da":s=e.rd;break;case "mo":s=
e.mo_num;break;case "ye":s=e.ye;break;case "de":s=Math.floor(e.ye/10);break;case "ce":s=Math.floor(e.ye/100);break;case "thou":s=Math.floor(e.ye/1E3);break;case "tenthou":s=Math.floor(e.ye/1E4);break;case "hundredthou":s=Math.floor(e.ye/1E5);break;case "mill":s=Math.floor(e.ye/1E6);break;case "tenmill":s=Math.floor(e.ye/1E7);break;case "hundredmill":s=Math.floor(e.ye/1E8);break;case "bill":s=Math.floor(e.ye/1E9)}return s};C.getMonthDays=function(e,q){return C.isLeapYear(q)==true&&e==2?29:C.monthsDayNums[e]};
C.twentyFourToTwelve=function(e){var q={};q.ye=e.ye;q.mo=e.mo;q.da=e.da;q.ho=e.ho;q.mi=e.mi;q.ampm="am";if(e.ho)if(e.ho>=12){q.ampm="pm";q.ho=e.ho>12?e.ho-12:12}else if(e.ho==0){q.ho=12;q.ampm="am"}else q.ho=e.ho;else{q.ho=12;q.mi=0;q.ampm="am"}return q};C.getMonthAdj=function(e,q){var s=C.getDateFromMonthNum(e);switch(s.mo){case 1:case 3:case 5:case 7:case 8:case 10:case 12:s=Math.floor(q+q/28*3);return{width:s,days:31};case 2:if(C.isLeapYear(s.ye)==true){s=Math.floor(q+q/28);return{width:s,days:29}}else return{width:q,
days:28};default:s=Math.floor(q+q/28*2);return{width:s,days:30}}};C.getDateFromMonthNum=function(e){var q=0;if(e>0){q=e%12;if(q==0)q=12;e=Math.ceil(e/12)}else{q=Math.abs(e)%12;q=12-q+1;if(q==13)q=1;e=-1*Math.ceil(Math.abs(e)/12)}return{ye:e,mo:q}};C.getMonthWidth=function(e,q,s){q=t/28;var z;switch(e){case 1:case 3:case 5:case 7:case 8:case 10:case 12:z=3;break;case 4:case 6:case 9:case 11:z=2;break;case 2:z=C.isLeapYear(yr)==true?1:0}return{width:Math.floor(s+q*z),numDays:28+z}};C.getToday=function(){var e=
new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":00"};C.getMonthFromRemDays=function(e,q){var s=0;var z=s=0;s=C.isLeapYear(q)?1:0;if(e<=31){z=1;s=e}else if(e>31&&e<=59+s){z=2;s=e-(31+s)}else if(e>59+s&&e<=90+s){z=3;s=e-(59+s)}else if(e>90+s&&e<=120+s){z=4;s=e-(90+s)}else if(e>120+s&&e<=151+s){z=5;s=e-(120+s)}else if(e>151+s&&e<=181+s){z=6;s=e-(151+s)}else if(e>181+s&&e<=212+s){z=7;s=e-(181+s)}else if(e>212+s&&e<=243+s){z=8;s=e-(212+s)}else if(e>
243+s&&e<=273+s){z=9;s=e-(243+s)}else if(e>273+s&&e<=304+s){z=10;s=e-(273+s)}else if(e>304+s&&e<=334+s){z=11;s=e-(304+s)}else{z=12;s=e-(334+s)}return{mo:z,da:s}};C.getDateFromRD=function(e){if(w[e])return w[e];for(var q=Math.floor(e),s=Math.floor(q/146097)*400,z=q-Math.floor(q/146097)*146097,f=1,k=s+1,o=k+400;k<=o;k++)if(z>365){z-=365;if(C.isLeapYear(k))z-=1;f++}else k=o;s+=f;if(z==0)z=1;z=C.getMonthFromRemDays(z,s);f=(e-q)*1440;q=Math.floor(f%60);f=Math.floor(f/60);if(C.isLeapYear(s)&&z.mo==2)z.da+=
1;q=s+"-"+z.mo+"-"+z.da+" "+f+":"+q+":00";return w[e]=q};C.getDateFromSec=function(e){if(h[e])return h[e];var q=C.getDateFromRD(e/86400);return h[e]=q};C.isLeapYear=function(e){return e%400==0?true:e%100==0?false:e%4==0?true:false};C.getRataDie=function(e){function q(c,a){if(B[c+"-"+a])return B[c+"-"+a];for(var n=0,g=c;g<a;g++)n+=C.isLeapYear(g)?366:365;return B[c+"-"+a]=n}function s(c,a){var n;switch(c){case 1:n=0;break;case 2:n=31;break;case 3:n=59;break;case 4:n=90;break;case 5:n=120;break;case 6:n=
151;break;case 7:n=181;break;case 8:n=212;break;case 9:n=243;break;case 10:n=273;break;case 11:n=304;break;case 12:n=334}if(c>2)if(C.isLeapYear(a))n+=1;return n}var z=e.ye,f=e.mo;e=e.da;var k=0;if(H[z+"-"+f+"-"+e])return H[z+"-"+f+"-"+e];if(z>=0){if(z==0)z=1;k=Math.floor(z/400)*146097;var o=parseInt(q(z-z%400,z)),D=parseInt(s(f,z));k=k+o+D+e-366}else if(z<0)k=C.getBCRataDie({ye:z,mo:f,da:e});return H[z+"-"+f+"-"+e]=k};C.monthNamesLet=["","J","F","M","A","M","J","J","A","S","O","N","D"];C.monthsDayNums=
[0,31,28,31,30,31,30,31,31,30,31,30,31,29];C.units=["da","mo","ye","de","ce","thou","tenthou","hundredthou","mill","tenmill","hundredmill","bill"];C.getBCRataDie=function(e){var q=e.ye,s=e.mo;e=e.da;if(x[q+"-"+s+"-"+e])return x[q+"-"+s+"-"+e];if(s==0)s=1;if(e==0)e=1;var z=-1*((Math.abs(q)-1)*366+[0,335,306,275,245,214,184,153,122,92,61,31,0][s]+(C.monthsDayNums[s]-e+1));return x[q+"-"+s+"-"+e]=z};C.setCulture=function(e){jQuery.global.culture=jQuery.global.cultures[e];C.monthNames=p.merge([""],jQuery.global.culture.calendar.months.names);
C.monthNamesAbbr=p.merge([""],jQuery.global.culture.calendar.months.namesAbbr);C.dayNames=jQuery.global.culture.calendar.days.names;C.dayNamesAbbr=jQuery.global.culture.calendar.days.namesAbbr;C.dayNamesShort=jQuery.global.culture.calendar.days.namesShort;C.patterns=jQuery.global.culture.calendar.patterns};C.prototype={format:function(e,q,s){s=s||{hours:0,minutes:0};if(q==true)switch(this.date_display.substr(0,2)){case "no":return"";case "ye":e="yyyy";break;case "mo":e="MMM yyyy";break;case "da":e=
"MMM d, yyyy";break;case "ho":e="MMM d, yyyy h:mm tt";break;default:e="f"}if(this.ye>-27E4){q=C.toFromUTC(_.clone(this),s,"from");q=new Date(q.ye,q.mo-1,q.da,q.ho,q.mi,q.se,0);return p.global.format(q,e)}else return this.ye}};C.getTimeOffset=function(e){e=e.replace(/[^-\d:]/gi,"");var q=e.split(":"),s=parseInt(q[0],10);q=parseInt(q[1],10);var z=s+(s<0?-1:1)*(q/60);return{decimal:z,hours:s,minutes:q,seconds:z*3600,string:e}};C.tzOffsetStr=function(e,q){if(e){if(e.length==19)e+=q;else if(e.length==
16)e+=":00"+q;return e}};C.parse8601=function(e){var q,s,z,f,k;k=function(D){return D?parseInt(D.replace("-",""),10):0};var o=e.match(I);e=parseInt(o[1]);if(!e)return{error:"invalid date; no year provided"};q=k(o[2])||1;s=k(o[3])||1;z=k(o[4])||1;f=k(o[5])||0;k=k(o[6])||0;tz_pm=o[7]||"+";tz_ho=parseInt(o[8],10)||0;if(tz_pm=="-")tz_ho*=-1;tz_mi=parseInt(o[9],10)||0;if(tz_pm=="-")tz_mi*=-1;return{ye:e,mo:q,da:s,ho:z,mi:f,se:k,tz_ho:tz_ho,tz_mi:tz_mi}};C.getLastDayOfMonth=function(e,q){var s=[0,31,28,
31,30,31,30,31,31,30,31,30,31],z=0;return z=q==2&&C.isLeapYear(e)==true?29:s[q]};C.getDateTimeStrings=function(e){var q=C.parse8601(e);e=q.ye+"-"+A(q.mo)+"-"+A(q.da);var s="pm";if(q.ho>12){q.ho-=12;s="pm"}else{if(q.ho==0)q.ho="12";s="am"}q=F(q.ho)+":"+A(q.mi)+" "+s;return{date:e,time:q}};C.transValidateDateString=function(e){if(!e)return false;var q=e.match(/^(\-?\d+|today|now) ?(bce?)?-?(\d{1,2})?-?(\d{1,2})?/);zb=C.zeroButt;if(q){e=q[1];var s=q[2]||"",z=q[3]||"07";q=q[4]||"1";if(parseInt(e,10)<
0||s.substr(0,1)=="b")e=-1*Math.abs(e);return C.validateDate(e,z,q)?e+"-"+zb(z)+"-"+zb(q):false}else return false};C.transValidateTimeString=function(e){if(!e)return"12:00:00";e=e.toLowerCase().match(/^(\d{1,2}|noon):?(\d{1,2})?:?(\d{1,2})? ?(am|pm)?/i);var q="";q=C.zeroButt;if(e[1])if(e[0]=="noon")q="12:00:00";else{var s=parseInt(e[1],10)||12,z=parseInt(e[2],10)||0,f=parseInt(e[3],10)||0;e=e[4]||"am";if(C.validateTime(s,z,f)==false)return false;if(e=="pm"&&s<12)s+=12;q=q(s)+":"+q(z)+":"+q(f)}else q=
false;return q};C.validateTime=function(e,q,s){if(e<0||e>23||q<0||q>59||s<0||s>59)return false;return true};C.validateDate=function(e,q,s){var z=C.getMonthDays(q,e);if(s>z||s<=0)return false;if(q>12||q<0)return false;if(e==0)return false;return true};C.zeroButt=function(e){e=parseInt(e,10);return e>9?String(e):"0"+e};C.toFromUTC=function(e,q,s){var z=0,f=[0,31,28,31,30,31,30,31,31,30,31,30,31,29];z={};if(s=="from"){z.ho=-1*q.hours;z.mi=-1*q.minutes}else if(s=="to"){z.ho=q.hours;z.mi=q.minutes}else{z.ho=
-1*e.tz_ho;z.mi=-1*e.tz_mi}if(z.ho==0&&z.mi==0)return e;s=e.ho+e.mi/60+(-1*z.ho+z.mi*-1/60);if(s<0){z=24+s;if(e.da>1)e.da-=1;else if(e.mo==1){e.ye-=1;e.mo=12;e.da=31}else{e.mo-=1;e.da=C.getLastDayOfMonth(e.ye,e.mo)}}else if(s>=24){z=s-24;if(C.isLeapYear(e.ye)&&e.mo==2&&e.da==28)e.da=29;else if(e.da==f[e.mo]){if(e.mo==12){e.ye+=1;e.mo=1}else e.mo+=1;e.da=1}else e.da+=1}else z=s;f=function(k){k=Math.abs(k);var o=Math.floor(k);return{ho:o,mi:Math.round((k-o)*60),se:0}}(z);e.ho=f.ho;e.mi=f.mi;if(q){e.tz_ho=
q.tz_ho;e.tz_mi=q.tz_mi}else{e.tz_ho=0;e.tz_mi=0}return{ye:e.ye,mo:e.mo,da:e.da,ho:e.ho,mi:e.mi,se:e.se}};C.timezones=[{offset:"-12:00",name:"Int'l Date Line West"},{offset:"-11:00",name:"Bering & Nome"},{offset:"-10:00",name:"Alaska-Hawaii Standard Time"},{offset:"-10:00",name:"U.S. Hawaiian Standard Time"},{offset:"-10:00",name:"U.S. Central Alaska Time"},{offset:"-09:00",name:"U.S. Yukon Standard Time"},{offset:"-08:00",name:"U.S. Pacific Standard Time"},{offset:"-07:00",name:"U.S. Mountain Standard Time"},
{offset:"-07:00",name:"U.S. Pacific Daylight Time"},{offset:"-06:00",name:"U.S. Central Standard Time"},{offset:"-06:00",name:"U.S. Mountain Daylight Time"},{offset:"-05:00",name:"U.S. Eastern Standard Time"},{offset:"-05:00",name:"U.S. Central Daylight Time"},{offset:"-04:00",name:"U.S. Atlantic Standard Time"},{offset:"-04:00",name:"U.S. Eastern Daylight Time"},{offset:"-03:30",name:"Newfoundland Standard Time"},{offset:"-03:00",name:"Brazil Standard Time"},{offset:"-03:00",name:"Atlantic Daylight Time"},
{offset:"-03:00",name:"Greenland Standard Time"},{offset:"-02:00",name:"Azores Time"},{offset:"-01:00",name:"West Africa Time"},{offset:"00:00",name:"Greenwich Mean Time/UTC"},{offset:"00:00",name:"Western European Time"},{offset:"01:00",name:"Central European Time"},{offset:"01:00",name:"Middle European Time"},{offset:"01:00",name:"British Summer Time"},{offset:"01:00",name:"Middle European Winter Time"},{offset:"01:00",name:"Swedish Winter Time"},{offset:"01:00",name:"French Winter Time"},{offset:"02:00",
name:"Eastean EU"},{offset:"02:00",name:"USSR-zone1"},{offset:"02:00",name:"Middle European Summer Time"},{offset:"02:00",name:"French Summer Time"},{offset:"03:00",name:"Baghdad Time"},{offset:"03:00",name:"USSR-zone2"},{offset:"03:30",name:"Iran"},{offset:"04:00",name:"USSR-zone3"},{offset:"05:00",name:"USSR-zone4"},{offset:"05:30",name:"Indian Standard Time"},{offset:"06:00",name:"USSR-zone5"},{offset:"06:30",name:"North Sumatra Time"},{offset:"07:00",name:"USSR-zone6"},{offset:"07:00",name:"West Australian Standard Time"},
{offset:"07:30",name:"Java"},{offset:"08:00",name:"China & Hong Kong"},{offset:"08:00",name:"USSR-zone7"},{offset:"08:00",name:"West Australian Daylight Time"},{offset:"09:00",name:"Japan"},{offset:"09:00",name:"Korea"},{offset:"09:00",name:"USSR-zone8"},{offset:"09:30",name:"South Australian Standard Time"},{offset:"09:30",name:"Central Australian Standard Time"},{offset:"10:00",name:"Guam Standard Time"},{offset:"10:00",name:"USSR-zone9"},{offset:"10:00",name:"East Australian Standard Time"},{offset:"10:30",
name:"Central Australian Daylight Time"},{offset:"10:30",name:"South Australian Daylight Time"},{offset:"11:00",name:"USSR-zone10"},{offset:"11:00",name:"East Australian Daylight Time"},{offset:"12:00",name:"New Zealand Standard Time"},{offset:"12:00",name:"Int'l Date Line East"},{offset:"13:00",name:"New Zealand Daylight Time"}];C.boil=F;C.unboil=A})(timeglider);(function(r){var F=r.levelHeight=12;r.TG_Org=function(){var A=this,p=r.icon_folder;this.blocks=[];this.ids=[];this.vis=[];this.tree=[];this.pol=-1;this.addBlock=function(w,h){w.right=w.left+w.width;w.bottom=w.top+w.height;w.tickScope=h;A.blocks.push(w)};this.getBorg=function(){return this};this.getBlocks=function(){return this.blocks};this.getHTML=function(w,h){if(w=="sweep"){H();this.vis=[]}this.blocks.sort(B);var I,C,e="",q="";html="";south_padding=0;b={};blength=this.blocks.length;b_span_color=
"";highest=title_adj=0;guageHighest=function(z){highest=z>highest?z:highest};for(var s=0;s<blength;s++){b=this.blocks[s];title_adj=0;if(b.tickScope==w)if(_.indexOf(b.id,this.vis)==-1){this.vis.push(b.id);if(b.html&&b.html.substr(0,4)=="<div")html+="<div style='left:"+b.left+"px' id='"+b.id+"'"+b.html.substr(4);else{if(b.image){if(b.image.display_class!="above"){img_scale=(b.image.scale||100)/100;if(img_scale<1){b.image_width=img_scale*b.image.width;b.image_height=img_scale*b.image.height;img_style=
" style='width:"+b.image_width+"px;height:auto' "}else{img_style="";b.image_width=b.image.width;b.image_height=b.image.height}title_adj=b.image_height+4}else img_style="";e="<div class='timeglider-event-image-"+b.image.display_class+"'><img src='"+b.image.src+"' "+img_style+"></div>"}else e="";if(b.y_position>0)b.top=A.pol*b.y_position;else x(b,0);guageHighest(Math.abs(b.top));b_span_color=b.span_color?";background-color:"+b.span_color:"";b.fontsize<10?b.opacity=b.fontsize/10:b.opacity=1;if(b.span==
true){I="timeglider-event-spanning";C="<div class='timeglider-event-spanner' style='top:px;height:"+b.fontsize+"px;width:"+b.spanwidth+"px"+b_span_color+"'></div>"}else C=I="";q=b.icon?"<img class='timeglider-event-icon' src='"+p+b.icon+"' style='height:"+b.fontsize+"px;left:-"+(b.fontsize+2)+"px; top:"+title_adj+"px'>":"";if(h&&A.pol==-1&&Math.abs(b.top)>h-16)html+="<div class='timeglider-more-plus' style='left:"+b.left+"px; top:-"+(h-Math.floor(16/3))+"px'>+</div>";else{south_padding=A.pol===1?
42:0;html+="<div class='timeglider-timeline-event "+b.css_class+" "+I+"' id='"+b.id+"' style='width:"+b.width+"px;height:"+b.height+"px;left:"+b.left+"px;opacity:"+b.opacity+";top:"+(b.top+south_padding)+"px;font-size:"+b.fontsize+"px;'>"+q+e+C+"<div class='timeglider-event-title' style='top:"+title_adj+"px'>"+b.title+"</div></div>"}}}}return{html:html,highest:highest}};var H=function(){A.tree=[];for(var w=0;w<300;w++)A.tree[w]=[]},B=function(w,h){var I=h.importance,C=w.importance;return I<C?-1:I>
C?1:0},x=function(w,h){var I=false,C=A.tree,e=C[h],q=h+1,s=false,z=2;if(e!=undefined){for(z=0;z<e.length;z++){a:{I=e[z];if(!(w.left>I.right||w.right<I.left))if(w.left>=I.left&&w.left<=I.right||w.right>=I.left&&w.right<=I.right||w.right>=I.right&&w.left<=I.left||w.right<=I.right&&w.left>=I.left)if(w.bottom<=I.bottom&&w.bottom>=I.top||w.top<=I.bottom&&w.top>=I.top||w.top==I.bottom&&w.top==I.top){I=true;break a}I=false}if(I==true){if(A.pol===-1){w.top-=F;w.bottom-=F}else{w.top+=F;w.bottom+=F}x(w,q);
s=true;break}}if(s==false){if(A.pol===-1)w.top-=w.fontsize;else w.top+=w.fontsize;e.push(w);if(typeof w.shape==="object"){e=q=s=0;s=Math.ceil(w.shape.ev_ht/F);for(q=1;q<=s;q++){e=h+q;C[e].push(w)}q=Math.ceil(w.shape.img_ht/F);s={left:w.left,right:w.left+w.image.width+32,top:w.top,bottom:w.bottom};for(z=1;z<=q;z++)C[e+z].push(s)}else{z=Math.ceil(w.height/F);for(q=1;q<=z;q++)C[h+q].push(w)}}}}}})(timeglider);(function(r){var F=r.TG_Date,A=jQuery,p=F.units,H;r.TG_EventCollection=Backbone.Collection.extend({eventHash:{},setTimelineHash:function(B,x){this.eventHash[B]=x},getTimelineHash:function(B){return this.eventHash[B]},model:r.TG_Event});r.TG_Event=Backbone.Model.extend({urlRoot:"/event",defaults:{title:"Untitled"},initialize:function(B){if(B.image){if(typeof B.image=="string")B.image={id:B.id,src:B.image,display_class:B.image_class||"above",width:0,height:0};else{B.image.display_class=B.image.display_class||
"above";B.image.width=0;B.image.height=0}this.getEventImageSize(B.image)}else B.image="";B.titleWidth=r.getStringWidth(B.title);this.set(B)},validate:function(){},getEventImageSize:function(B){function x(I,C){return function(){return C.apply(I,arguments)}}var w=this,h=new Image;h.src=B.src;h.onerror=x(h,function(){});h.onload=x(h,function(){w.get("image").height=this.height;w.get("image").width=this.width})}});r.TG_TimelineCollection=Backbone.Collection.extend({model:r.TG_Timeline});r.TG_Timeline=
Backbone.Model.extend({urlRoot:"/timeline",defaults:{initial_zoom:25,focus_date:"today",timezone:"00:00",title:"Untitled",events:[],legend:[]},_chewTimeline:function(B){H=B.mediator;B.timeline_id=B.id;var x={all:[],da:[],mo:[],ye:[],de:[],ce:[],thou:[],tenthou:[],hundredthou:[],mill:[],tenmill:[],hundredmill:[],bill:[]};B.spans={};B.hasImagesAbove=false;B.startSeconds=[];B.endSeconds=[];B.focusDateObj=new F(B.focus_date);B.size_importance=B.size_importance=="false"?false:true;B.timeOffset=F.getTimeOffset(B.timezone||
"00:00");if(!B.color)B.color="#333333";if(B.events.length>0){for(var w,h,I,C,e=B.events.length,q=0;q<e;q++){h=B.events[q];if(h.id)I=h.id;else h.id=I="anon"+this.anonEventId++;if(h.map)if(H.main_map){if(timeglider.mapping.ready)h.map.marker_instance=timeglider.mapping.addAddMarkerToMap(h,H.main_map)}else r.googleMapsLoad();w=h.date_display||h.date_limit||"da";h.date_display=w.toLowerCase().substr(0,2);if(B.timeOffset.seconds){h.startdate=F.tzOffsetStr(h.startdate,B.timeOffset.string);if(h.enddate)h.enddate=
F.tzOffsetStr(h.enddate,B.timeOffset.string)}h.startdateObj=new F(h.startdate,h.date_display);if(h.enddate&&h.enddate!==h.startdate){h.enddateObj=new F(h.enddate,h.date_display);h.span=true;B.spans["s_"+h.id]={id:h.id,start:h.startdateObj.sec,end:h.enddateObj.sec}}else{h.enddateObj=h.startdateObj;h.span=false}if(h.image)if(h.image.display_class!="inline")B.hasImagesAbove=true;B.startSeconds.push(h.startdateObj.sec);B.endSeconds.push(h.enddateObj.sec);h.cache={span:h.span,startdateObj:_.clone(h.startdateObj),
enddateObj:_.clone(h.enddateObj)};h.icon=!h.icon||h.icon==="none"?"":h.icon;x.all.push(I);for(var s=p.length,z=0;z<s;z++){w=p[z];C=F.getTimeUnitSerial(h.startdateObj,w);if(x[w][C]!==undefined)x[w][C].push(I);else x[w][C]=[I]}if(H.eventCollection.get(I))H.eventCollection.get(I).get("timelines").push(B.timeline_id);else{h.timelines=[B.timeline_id];h=new r.TG_Event(h);H.eventCollection.add(h)}}e=A.merge(B.startSeconds,B.endSeconds);e=_.sortBy(e,function(f){return parseInt(f)});B.bounds={first:_.first(e),
last:_.last(e)};B.has_events=true}else B.has_events=false;B.hasLegend=B.legend.length>0?true:false;B.display="expanded";H.eventCollection.setTimelineHash(B.timeline_id,x);delete B.events;return B},initialize:function(B){this.set(this._chewTimeline(B));this.bind("change",function(){})}})})(timeglider);(function(r){var F=r.TG_Date,A="",p="",H={},B=0,x=0,w=0,h=jQuery,I={},C="",e,q,s,z=h.support.touch?"touchstart":"click";r.TG_PlayerView=function(f,k){var o=this;p=k;H=p.options;A="#"+f._id;C=f._id;this._views={PLACE:A,CONTAINER:A+" .timeglider-container",DATE:A+" .timeglider-date-display",TIMELINE_MENU:A+" .timeglider-timeline-menu",TIMELINE_MENU_UL:A+" .timeglider-timeline-menu ul",TIMELINE_LIST_BT:A+" .timeglider-list-bt",SLIDER_CONTAINER:A+" .timeglider-slider-container",SLIDER:A+" .timeglider-slider",
ZOOM_DISPLAY:A+" .timeglider-zoomlevel-display",TRUCK:A+" .timeglider-truck",CENTERLINE:A+" .timeglider-centerline",TICKS:A+" .timeglider-ticks",HANDLE:A+" .timeglider-handle",FOOTER:A+" .timeglider-footer",FILTER_BT:A+" .timeglider-filter-bt",FILTER_BOX:A+" .timeglider-filter-box",SETTINGS_BT:A+" .timeglider-settings-bt"};e=this._views.CONTAINER;q=this._views.TICKS;s=this._views.DATE;this.initTimelineVOffset=100;this.tick_height=34;this.imageLaneHeight=60;this._templates={};this._templates={test:"testola",
event_modal_small:"<div class='tg-modal timeglider-ev-modal ui-widget-content' id='${id}_modal'><div class='close-button-remove'></div><div class='dateline'>{{html dateline}}</div><h4 id='title'>${title}</h4><p>{{html image}}{{html description}}</p><ul class='timeglider-ev-modal-links'>{{html links}}</ul></div>",event_modal_full:h.template(null,"<div class='tg-modal full_modal' id='ev_${id}_modal'><div class='full_modal_scrim'></div><div class='full_modal_panel'><div class='close-button full_modal_close'>x</div><div class='dateline'>{{html dateline}}</div><table><tr><td><h4>${title}</h4><div class='description'><p>{{html description}}</p></div></td><td><div>{{html image}}</div><div id='insert'></div></td></tr></table><div class='footer'><ul>{{html links}}</ul></div></div>"),
filter_modal:h.template(null,"<div class='tg-modal timeglider-menu-modal timeglider-filter-box'><div class='close-button'></div><h3>filter</h3><div class='timeglider-menu-modal-content'><div class='timeglider-formline'>show: <input type='text' class='timeglider-filter-include'></div><div class='timeglider-formline'>hide: <input type='text' class='timeglider-filter-exclude'></div><ul><li class='timeglider-filter-clear'>clear</li><li class='timeglider-filter-apply'>apply</li></ul></div><div class='timeglider-menu-modal-point-right'></div>"),
timeline_list_modal:h.template(null,"<div class='timeglider-menu-modal timeglider-timeline-menu'><div class='close-button'></div><h3>timelines</h3><div class='timeglider-menu-modal-content'><ul></ul></div><div class='timeglider-menu-modal-point-right'></div>"),settings_modal:h.template(null,"<div class='timeglider-menu-modal timeglider-settings-modal'><div class='close-button'></div><h3>settings</h3><div class='timeglider-menu-modal-content'><div class='timeglider-settings-timezone'></div></div><div class='timeglider-menu-modal-point-right'></div>"),
legend_modal:h.template(null,"<div class='timeglider-menu-modal timeglider-legend timeglider-display-none'  id='${id}_legend'><div class='timeglider-menu-modal-content'><ul id='${id}'>{{html legend_list}}</ul><div class='timeglider-close-button-small timeglider-legend-close'></div><div class='timeglider-legend-all'>all</div></div></div>")};this.timelineModal=r.TG_TimelineView.extend({tagName:"div",model:r.TG_Timeline,className:"tg-modal timeglider-timeline-modal ui-widget-content",events:{"click .close-button-remove":"remove"},
template:"<div class='close-button-remove'></div><h4 id='title'>${title}</h4><p>{{html description}}</p>",initialize:function(){this.model.bind("change",this.render,this)},render:function(){h(this.el).html(h.tmpl(this.template,this.model.attributes)).attr("id",this.model.get("id")+"_timelineModal");return this},remove:function(){h(this.el).fadeOut()}});h(e).delegate(".tg-timeline-envelope .timeline-info","click",function(){var c=h(this).data("timeline_id");o.openTimelineModal(c)}).delegate(".tg-timeline-envelope .expand-collapse",
"click",function(){var c=h(this).data("timeline_id");o.expandCollapseTimeline(c)}).delegate(".tg-timeline-envelope .tg-timeline-legend-bt","click",function(){var c=h(this).data("timeline_id");o.legendModal(c)}).delegate(".close-button-remove","click",function(){var c=h(this).parent().attr("id");h("#"+c).remove()}).delegate(".full_modal_scrim, .full_modal_close","click",function(){h(".full_modal").remove()}).delegate(".timeglider-more-plus","click",function(){p.zoom(-1)}).delegate(".timeglider-legend-close",
"click",function(){var c=h(e+" .timeglider-legend");c.fadeOut(300,function(){c.remove()})}).delegate(".timeglider-legend-all","click",function(){h(e+" .timeglider-legend li").each(function(){h(this).removeClass("tg-legend-icon-selected")});p.setFilters({origin:"legend",icon:"all"})}).css("height",h(A).height());this.basicFontSize=H.basic_fontsize;H.show_footer==false&&h(this._views.FOOTER).css("display","none");this.dragSpeed=0;this.dimensions=p.dimensions=this.getWidgetDimensions();this.ticksHandleOffset=
this.rightside=this.leftside=this.tickNum=0;this.timeoout_id=1;this.sliderActive=false;this.ztop=1E3;this.filterBoxActivated=false;this.buildSlider();this.setupFilter();this.setPanButton(h(".timeglider-pan-right"),-30);this.setPanButton(h(".timeglider-pan-left"),30);h(this._views.TRUCK).bind("dblclick",function(c){p.registerUIEvent({name:"dblclick",event:c,dimensions:o.dimensions})}).bind("mousewheel",function(c,a){var n=Math.ceil(-1*a*3),g=p.getZoomLevel();p.setZoomLevel(g+n);return false});h(q).draggable({axis:"x",
start:function(){},drag:function(){x=Math.floor(h(this).position().left);p.setTicksOffset(x);B=x-w;w=x},stop:function(){o.resetTicksHandle();o.registerDragging()}}).delegate(e+" .timeglider-timeline-event",z,function(){var c=h(this).attr("id"),a=p.eventCollection.get(c).attributes;if(timeglider.mode!="authoring")if(a.click_callback){c=a.click_callback.split(".");var n=c.length;if(n==1)window[c[0]](a);else if(n==2)window[c[0]][c[1]](a);else if(n==3)window[c[0]][c[1]][c[2]](a)}else o.eventModal(c)}).delegate(".timeglider-timeline-event",
"mouseover",function(){var c=p.eventCollection.get(h(this).attr("id")).attributes;o.eventHover(h(this),c)}).delegate(".timeglider-timeline-event","mouseout",function(){var c=p.eventCollection.get(h(this).attr("id")).attributes;o.eventUnHover(h(this),c)}).delegate(".timeglider-event-collapsed","hover",function(){p.eventCollection.get(h(this).attr("id"))});o.setCenterline();h.subscribe("mediator.ticksOffsetChange",function(){o.tickHangies();o.registerDragging();o.registerTitles()});h.subscribe("mediator.focusToEvent",
function(){});h.subscribe("mediator.zoomLevelChange",function(){o.tickNum=0;o.leftside=0;var c=p.getZoomLevel();h(o._views.SLIDER).slider("value",o.invSliderVal(c));o.displayZoomLevel(c);o.castTicks("zoomLevelChange")});h.subscribe("viewer.rendered",function(){});h.subscribe("mediator.ticksReadySignal",function(){p.ticksReady===true&&o.freshTimelines()});h.subscribe("mediator.refreshSignal",function(){o.tickNum=0;o.leftside=0;o.castTicks("refreshSignal")});h.subscribe("mediator.ticksArrayChange",
function(){});h.subscribe("mediator.focusDateChange",function(){this.displayFocusDate()});h.subscribe("mediator.timelineDataLoaded",function(){h(".timeglider-loading").fadeOut(500);o.buildSettingsMenu();o.buildTimelineMenu()});h.subscribe("mediator.activeTimelinesChange",function(){h(o._views.TIMELINE_MENU_UL+" li").each(function(){var c=h(this).data("timeline_id");h.inArray(c,p.activeTimelines)!=-1?h(this).addClass("activeTimeline"):h(this).removeClass("activeTimeline")})});h.subscribe("mediator.filterChange",
function(){});if(h.support.touch){h("#"+C).addTouch();var D=document.getElementById(C);D.addEventListener("gesturestart",function(c){c.preventDefault();h("#output").append("<br>gesture zoom:"+p.getZoomLevel())},false);D.addEventListener("gestureend",function(c){c.preventDefault();h("#output").append("<br>gesture end:"+p.getZoomLevel())},false);D.addEventListener("gesturechange",function(c){c.preventDefault();c.preventDefault();if(p.gesturing===false){p.gesturing=true;p.gestureStartZoom=p.getZoomLevel()}p.setZoomLevel(Math.ceil(p.gestureStartZoom/
c.scale))},false)}};r.TG_PlayerView.prototype={resize:function(){var f=h(A).height();h(e).height(f);this.dimensions=this.getWidgetDimensions();p.setDimensions(this.dimensions);this.setCenterline();p.refresh()},getWidgetDimensions:function(){var f=h(e),k=f.width(),o=Math.floor(k/2)+1,D=f.height(),c=Math.floor(D/2),a=this.tick_height,n=f.position().left;f=f.offset();var g=H.show_footer==true?h(this._views.FOOTER).height():0;return{container:{width:k,height:D,centerx:o,centery:c,left:n,offset:f},tick:{top:D-
g-a},footer:{height:g}}},scaleToImportance:function(f,k){return f/k},displayZoomLevel:function(){var f=p.getZoomLevel();f>0&&H.display_zoom_level==true&&h(this._views.ZOOM_DISPLAY).text(f)},displayFocusDate:function(){var f=p.getFocusDate();h(s).text(f.format("d MMM yyyy",false))},setPanButton:function(f,k){var o=this;h(f).live("mousedown",function(){o.intervalMachine("pan",{type:"set",fn:o.pan,args:[k],intvl:33})}).live("mouseup",function(){o.intervalMachine("pan",{type:"clear",fn:o.pan,callback:"resetTicksHandle"})}).live("mouseout",
function(){o.intervalMachine("pan",{type:"clear",fn:o.pan,callback:"resetTicksHandle"})})},intervalMachine:function(f,k){var o=this;if(k.type==="clear"){clearInterval(I[f]);if(k.callback)o[k.callback]()}else I[f]=setInterval(function(){k.fn.apply(o,k.args)},k.intvl)},invSliderVal:function(f){return Math.abs(f-101)},pan:function(f){f=f||20;$t=h(q);newPos=$t.position().left+f;$t.css({left:newPos});p.setTicksOffset(newPos)},registerTitles:function(){var f,k,o,D,c,a,n,g,l,j=h(e).offset().left;h(".timeglider-event-spanning").each(function(){f=
h(this).offset().left-j;k=h(this).outerWidth();a=h(".timeglider-event-title",this);o=a.outerWidth()+5;D=a.siblings(".timeglider-event-spanner").outerWidth();D>o&&f<0&&Math.abs(f)<k-o&&a.css({marginLeft:-1*f+5})});h.browser.msie&&parseInt(h.browser.version);h(".tg-timeline-envelope").each(function(){n=h(this);g=n.offset().left-j;$tb=n.find(".titleBar");c=$tb.data("lef");l=-1*(c+g);$ti=$tb.find(".timeline-title");l>0&&l<$tb.width()-$ti.width()&&$ti.css({marginLeft:l+5})})},registerDragging:function(){var f=
p.startSec,k=h(q).position().left,o=p.getZoomInfo().spp;f=new F(f-k*o);p.setFocusDate(f);this.displayFocusDate()},setupFilter:function(){var f=this;$filter=h.tmpl(f._templates.filter_modal,{}).appendTo(f._views.CONTAINER);$filter.css("z-index",f.ztop++).position({my:"right bottom",at:"right top",of:h(f._views.FILTER_BT),offset:"-8, -12"}).hide();h(e).delegate(".timeglider-filter-box .close-button","click",function(){$filter.fadeOut()});h(f._views.FILTER_BT).bind("click",function(){$filter.fadeIn();
h(this);var k=f._views.FILTER_BOX;if(f.filterBoxActivated==false){f.filterBoxActivated=true;var o=h(k+" .timeglider-filter-apply"),D=h(".timeglider-filter-box .close-button"),c=h(k+" .timeglider-filter-clear"),a="",n="";o.bind("click",function(){a=h(k+" .timeglider-filter-include").val();n=h(k+" .timeglider-filter-exclude").val();p.setFilters({origin:"clude",include:a,exclude:n});h(k).toggleClass("timeglider-display-block")});D.bind("click",function(){h(k).toggleClass("timeglider-display-none")});
c.bind("click",function(){p.setFilters({origin:"clude",include:"",exclude:""});h(k+" .timeglider-filter-include").val("");h(k+" .timeglider-filter-exclude").val("");h(k).toggleClass("timeglider-display-block")})}})},buildTimelineMenu:function(){var f=this,k;h(f._views.TIMELINE_LIST_BT);h(f._views.TIMELINE_MENU)[0]&&h(f._views.TIMELINE_MENU).remove();k=h.tmpl(f._templates.timeline_list_modal,{}).appendTo(f._views.CONTAINER);var o=Backbone.View.extend({initialize:function(){this.model.bind("change",
this.render,this)},tagName:"li",className:"timeglider-timeline-list-item",template:"${title}",events:{click:"toggleTimeline"},toggleTimeline:function(){p.toggleTimeline(this.model.get("id"))},render:function(){var D=this.model.get("id");h(this.el).html(h.tmpl(this.template,this.model.attributes)).data("timeline_id",D);return this}});h(f._views.TIMELINE_MENU_UL).html("");_.each(p.timelineCollection.models,function(D){h(f._views.TIMELINE_MENU_UL).append((new o({model:D})).render().el)});k.position({my:"right bottom",
at:"right top",of:h(f._views.TIMELINE_LIST_BT),offset:"-8, -12"}).hide();h(e).delegate(".timeglider-timeline-menu .close-button","click",function(){k.fadeOut()}).delegate(this._views.TIMELINE_LIST_BT,"click",function(){k.fadeIn()})},getTimezonePulldown:function(f,k){var o="<select name='timezone' id='"+f+"'>",D=false,c="selected";h.map(F.timezones,function(a){if(k==a.offset&&D==false){c="selected";D=true}else c="";o+="<option value='"+a.offset+"' "+c+">"+a.name+"</option>"});o+="</select>";return o},
buildSettingsMenu:function(){var f=h.tmpl(this._templates.settings_modal,{}).appendTo(this._views.CONTAINER),k=this.getTimezonePulldown("timeglider-settings-timezone",p.timeOffset.string);f.find(".timeglider-settings-timezone").append('<p>Make changes below, then click on "save". More settings options to come!</p>').append('<span class="settings-label">timezone:</span> '+k).append("<p style='clear:both'>&nbsp;</p><div class='btn success' id='timeglider-settings-save'>save</div>");f.position({my:"right bottom",
at:"right top",of:h(this._views.SETTINGS_BT),offset:"-8, -12"}).hide();h(e).delegate(".timeglider-settings-modal .close-button","click",function(){f.fadeOut()}).delegate(this._views.SETTINGS_BT,"click",function(){f.fadeIn()}).delegate("#timeglider-settings-save","click",function(){var o=h(e+" #timeglider-settings-timezone").val();p.setTimeoffset(o)})},buildSlider:function(){var f=p.getZoomLevel();if(H.min_zoom==H.max_zoom)h(this._views.SLIDER_CONTAINER).css("display","none");else{H.display_zoom_level==
true&&h("<div>").appendTo(this._views.SLIDER_CONTAINER).addClass("timeglider-zoomlevel-display").html("&nbsp;");var k=this;f=k.invSliderVal(f);var o=p.max_zoom,D=p.min_zoom;h(this._views.SLIDER).css("height",(1+o-D)*3).slider({steps:100,handle:h(".knob"),animate:300,orientation:"vertical",min:k.invSliderVal(o),max:k.invSliderVal(D),value:f,start:function(){k.sliderActive=true},stop:function(){k.sliderActive=false},change:function(){},slide:function(c,a){p.setZoomLevel(k.invSliderVal(a.value))}})}},
getEventDateLine:function(f){var k="<span class='timeglider-dateline-startdate'>"+f.startdateObj.format("",true,p.timeOffset)+"</span>";endDateF="";if(f.span==true)endDateF=" &ndash; <span class='timeglider-dateline-enddate'>"+f.enddateObj.format("",true,p.timeOffset)+"</span>";return k+endDateF},eventHover:function(f,k){var o=h(".timeglider-event-hover-info");k.date_display!="no"&&o.position({my:"left bottom",at:"left top",of:f,offset:"1, -10",collision:"flip flip"}).html(this.getEventDateLine(k));
f.addClass("tg-event-hovered")},eventUnHover:function(f){h(".timeglider-event-hover-info").css("left","-1000px");f.removeClass("tg-event-hovered")},clearTicks:function(){this.tickNum=this.leftside=0;h(q).css("left",0);h(e+" .tg-timeline-envelope").remove();h(e+" .timeglider-tick").remove()},castTicks:function(){this.clearTicks();p.getZoomLevel();var f=p.getFocusDate(),k=p.getZoomInfo().width;k=Math.ceil(this.dimensions.container.width/k)+4;var o="l";p.setTicksReady(false);this.addTick({type:"init",
focus_date:f});for(f=1;f<=k;f+=1){this.addTick({type:o});o=o=="l"?"r":"l"}p.setTicksReady(true);this.displayFocusDate()},addTick:function(f){var k=0,o=0,D=o=0,c=0,a=0,n=a="",g={};a={};D={};var l={};a={};g="";l=p.getZoomInfo().unit;var j=p.getZoomInfo().width;c=p.getFocusDate();D=parseInt(this.dimensions.tick.top);c=p.addToTicksArray({type:f.type,unit:l},c);if(l=="mo"){a=F.getMonthAdj(c,j);j=a.width;k=a.days}this.tickNum++;if(f.type=="init"){a=this.tickOffsetFromDate(p.getZoomInfo(),p.getFocusDate(),
j);this.leftside=o=Math.ceil(this.dimensions.container.centerx+a);this.rightside=o+j}else if(f.type=="l")this.leftside=o=Math.floor(this.leftside-j);else if(f.type=="r"){o=Math.floor(this.rightside);this.rightside+=j}p.getTickBySerial(c).width=j;p.getTickBySerial(c).left=o;a=this._views.PLACE+"_"+l+"_"+c+"-"+this.tickNum;a=h("<div class='timeglider-tick' id='"+a+"'><div class='timeglider-tick-label' id='label'></div></div>").appendTo(q);a.css({width:j,left:o,top:D});D=this.getTickMarksInfo({unit:l,
width:j});D=k||D.tperu;o=j/D;if(o>5)for(f=k=0;f<D;f++){n="&nbsp;";if(o>16)if(l=="da")n=this.getHourLabelFromHour(f,o);else if(l=="mo")n=f+1;else if(l=="ye")n=o>30?"&nbsp;"+F.monthNamesAbbr[f+1]:"&nbsp;"+F.monthNamesLet[f+1];else if(l=="de"){if(o>44)n=c+""+f}else if(l=="ce")if(o>28)n=c+""+f+"0";g+="<div class='timeglider-tick-sub-label' style='left:"+k+"px;width:"+o+"px'>"+n+"</div>";k+=o}g&&a.append("<div style='background-color:none;height:24px;width:"+(j+10)+"px;position:absolute;top:15px;left:0;overflow:hidden'>"+
g+"</div>");l={unit:l,width:j,serial:c};g=this.getDateLabelForTick(l);a.children("#label").text(g);return l},setCenterline:function(){p.options.show_centerline===true?h(this._views.CENTERLINE).css({height:this.dimensions.container.height,left:this.dimensions.container.centerx}):h(this._views.CENTERLINE).css({display:"none"})},getHourLabelFromHour:function(f,k){var o="",D=f,c="";if(k<16)return"";else{if(f>12)D=f-12;else if(f==0)D=12;if(k>30)o=f>11?" pm":" am";if(k>200){sl4hd=k/4-4;return"<div class='minutes' style='width:"+
sl4hd+"px'>"+D+":00 "+o+"</div><div class='minutes' style='width:"+sl4hd+"px'>"+D+":15 "+o+"</div><div class='minutes' style='width:"+sl4hd+"px'>"+D+":30 "+o+"</div><div class='minutes' style='width:"+sl4hd+"px'>"+D+":45 "+o+"</div>"}else return D+(k>60?":00":"")+o}},getTickMarksInfo:function(f){switch(f.unit){case "da":f=24;break;case "mo":f=30;break;case "ye":f=12;break;default:f=10}return{tperu:f}},getDateLabelForTick:function(f){var k=f.serial,o=f.width;switch(f.unit){case "bill":return k==0?
"1":k>0?k+" billion":k+" b.y. bce";case "hundredmill":return k==0?"1":k>0?k+"00 million":k+"00 m.y. bce";case "tenmill":return k==0?"1":k>0?k+"0 million":k+"0 m.y. bce";case "mill":return k==0?"1":k>0?k+" million":k+" m.y. bce";case "hundredthou":return k==0?"1":k>0?k+"00,000":k+"00,000 bce";case "tenthou":return k==0?"1":k>0?k+"0,000":k+"0,000 bce";case "thou":return k==0?"1("+k+")":k>0?k+"000":k+"000 bce";case "ce":return k==0?"1("+k+")":k>0?k+"00":k+"00 bce";case "de":return k>120?k*10+"s":k*10;
case "ye":return k;case "mo":f=F.getDateFromMonthNum(k);return o<120?F.monthNamesAbbr[f.mo]+" "+f.ye:F.monthNames[f.mo]+", "+f.ye;case "da":f=new F(F.getDateFromRD(k));return o<120?F.monthNamesAbbr[f.mo]+" "+f.da+", "+f.ye:F.monthNames[f.mo]+" "+f.da+", "+f.ye;default:return f.unit+":"+k+":"+o}},tickHangies:function(){var f=h(q).position().left,k=this.rightside+f-this.dimensions.container.width;if(this.leftside+f>-100){f=this.addTick({type:"l"});this.appendTimelines(f)}else if(k<100){f=this.addTick({type:"r"});
this.appendTimelines(f)}},tickOffsetFromDate:function(f,k,o){switch(f.unit){case "da":k=k.ho/24+k.mi/1440;o*=k;break;case "mo":f=F.getMonthDays(k.mo,k.ye);k=(k.da-1)/f+k.ho/(24*f)+k.mi/(1440*f);o*=k;break;case "ye":k=((k.mo-1)*30+k.da)/365;o*=k;break;case "de":k=k.ye%10/10+k.mo/120;o*=k;break;case "ce":k=k.ye%100/100+k.mo/1200;o*=k;break;case "thou":k=k.ye%1E3/1E3;o*=k;break;case "tenthou":k=k.ye%1E4/1E4;o*=k;break;case "hundredthou":k=k.ye%1E5/1E5;o*=k;break;default:o=0}return-1*o},resetTicksHandle:function(){h(this._views.HANDLE).offset({left:h(e).offset().left})},
easeOutTicks:function(){Math.abs(B)>5&&h(q).animate({left:"+="+3*B},1E3,"easeOutQuad",function(){debug.trace("stopping easing","note")})},getTimelineEventsByTick:function(f){var k=f.tick.unit,o=f.tick.serial;f=p.eventCollection.getTimelineHash(f.timeline.timeline_id);return f[k][o]&&f[k][o].length>0?f[k][o]:0},passesFilters:function(f,k){var o=true,D="",c=[],a;D="";c=[];if(k<f.low_threshold||k>f.high_threshold)return false;if(D=p.filters.include){c=D.split(",");o=false;for(a=0;a<c.length;a++){D=RegExp(h.trim(c[a]),
"i");if(f.title.match(D))o=true}}if(D=p.filters.exclude){c=D.split(",");for(a=0;a<c.length;a++){D=RegExp(h.trim(c[a]),"i");if(f.title.match(D))o=false}}D=f.icon;if(p.filters.legend.length>0)if(h.inArray(D,p.filters.legend)==-1)o=false;return o},freshTimelines:function(){var f=this,k,o,D,c=p.activeTimelines,a=p.ticksArray,n="",g;o="";var l=f.dimensions.container.centerx;k=f.dimensions.container.width;var j=p.getFocusDate().sec,u=p.getZoomInfo().spp;p.getZoomInfo();o=[];var v=[],G=j-Math.floor(u*(k/
2));D=g=0;for(var d,i=0,m=f.dimensions.container.height,y=i=0;y<c.length;y++){v=[];o=p.timelineCollection.get(c[y]);k=o.attributes;d=k.display;i=k.top?parseInt(k.top.replace("px","")):m-f.initTimelineVOffset;o=new r.TG_TimelineView({model:o});g=p.timeOffset.seconds/u;$tl=h(o.render().el).appendTo(q);$tl.draggable({axis:"y",handle:".titleBar",stop:function(){var E=h(this).css("top"),J=h(this).attr("id");p.timelineCollection.get(J).set({top:E});p.refresh()}}).css({top:i,left:g});g=$tl.find(".titleBar");
if(typeof k.bounds!="undefined"){o=l+(k.bounds.first-j)/u;D=l+(k.bounds.last-j)/u}else{o=l;D=l+300}D-=o;g.css({top:void 0,left:o,width:D}).data({lef:o,wid:D});if(d=="expanded")k.borg=n=new timeglider.TG_Org;for(g=0;g<a.length;g++){o=this.getTimelineEventsByTick({tick:a[g],timeline:k});h.merge(v,o)}_.each(k.spans,function(E){E.start<G&&E.end>G&&h.inArray(E.id,v)==-1&&v.unshift(E.id)});o=this.compileTickEventsAsHtml(k,v,0,"sweep");i=H.event_overflow=="scroll"?0:k.hasImagesAbove?i-f.imageLaneHeight:
i;if(d=="expanded"){o=n.getHTML("sweep",i);k.borg=n.getBorg()}o!="undefined"&&$tl.append(o.html);setTimeout(function(){f.registerEventImages($tl)},3)}f.registerTitles();h.publish("viewer.rendered")},appendTimelines:function(f){for(var k=p.activeTimelines,o,D="",c=0;c<k.length;c++){o=p.timelineCollection.get(k[c]).attributes;idArr=this.getTimelineEventsByTick({tick:f,timeline:o});D=this.compileTickEventsAsHtml(o,idArr,f.serial,"append");if(o.display=="expanded")D=o.borg.getHTML(f.serial,o.top);o=h(e+
" .tg-timeline-envelope#"+o.id).append(D.html);this.registerEventImages(o)}h.publish("viewer.rendered")},compileTickEventsAsHtml:function(f,k,o,D){var c=0,a=this.dimensions.container.centerx,n=f.display,g=$tl.height();stuff="";foSec=p.startSec;spp=p.getZoomInfo().spp;zl=p.getZoomInfo().level;buffer=20;img_ht=0;borg=f.borg;block_arg="sweep";if(D=="append")block_arg=o;for(o=0;o<k.length;o++){ev=p.eventCollection.get(k[o]).attributes;if(this.passesFilters(ev,zl)===true){c=a+(ev.startdateObj.sec-foSec)/
spp;if(n=="expanded"){impq=f.size_importance!==false?this.scaleToImportance(ev.importance,zl):1;ev.width=ev.titleWidth*impq+buffer;ev.fontsize=this.basicFontSize*impq;ev.left=c;ev.spanwidth=0;if(ev.span==true){ev.spanwidth=(ev.enddateObj.sec-ev.startdateObj.sec)/spp;if(ev.spanwidth>ev.width)ev.width=ev.spanwidth}img_ht=0;c=Math.ceil(ev.fontsize);if(ev.image&&ev.image.display_class==="inline"){img_ht=(ev.image.scale||100)/100*ev.image.height+2;ev.width=ev.image.width>ev.width?ev.image.width:ev.width;
ev.shape={ev_ht:c,img_ht:img_ht+32}}ev.height=c+img_ht;ev.top=g-ev.height;borg.addBlock(ev,block_arg)}else if(n=="collapsed")stuff+="<div id='"+ev.id+"' class='timeglider-event-collapsed' style='top:"+(g-2)+"px;left:"+c+"px'></div>"}}return n=="collapsed"?stuff:""},registerEventImages:function(f){h(e+" .timeglider-event-image-bar").each(function(){h(this).position({my:"top",at:"bottom",of:f,offset:"0, 0"}).css("left",0)});h(e+" .timeglider-event-image-above").each(function(){h(this).css("display",
"block").position({my:"top",at:"top",of:h(e),offset:"0, 12"}).css({left:0})})},expandCollapseTimeline:function(f){f=p.timelineCollection.get(f).attributes;f.display=f.display=="expanded"?"collapsed":"expanded";p.refresh()},openTimelineModal:function(f){f=new this.timelineModal({model:p.timelineCollection.get(f)});h(f.render().el).appendTo("body").position({my:"left top",at:"left top",of:this._views.CONTAINER,offset:"32, 32",collision:"fit fit"}).css("z-index",this.ztop++).draggable({stack:".timeglider-modal"})},
createEventLinksMenu:function(f){if(!f)return"";var k="",o=0,D="",c="";if(typeof f=="string")k="<li><a href='"+f+"' target='_blank'>link</a></li>";else if(typeof f=="object")for(o=0;o<f.length;o++){D=f[o].url;c=f[o].label;k+="<li><a href='"+D+"' target='_blank'>"+c+"</a></li>"}return k},eventModal:function(f){h(e+" #"+f+"_modal").remove();var k=this,o=false,D=false,c="";c={};c=0;c=h("#"+f);var a=p.eventCollection.get(f).attributes,n=a.modal_type||H.event_modal.type,g=a.image&&a.image.src?"<img src='"+
a.image.src+"'>":"",l=this.createEventLinksMenu(a.link);f={title:a.title,description:a.description,id:f,dateline:k.getEventDateLine(a),links:l,image:g};if(a.video){f.video=a.video;n="full";D=true;f.video=a.video}else if(a.map&&a.map.latlong){o=true;n="full"}switch(n){case "full":f=h.tmpl(k._templates.event_modal_full,f);f.appendTo(e).css({"z-index":k.ztop++}).position({my:"left top",at:"left top",of:e,offset:"0, 0",collision:"none none"});if(o==true){f.find("#insert").append("<div id='map_modal_map'></div>");
c=a.map.zoom||12;llarr=String(a.map.latlong).split(",");map_ll=new google.maps.LatLng(parseFloat(llarr[0]),parseFloat(llarr[1]));c={zoom:c,center:map_ll,mapTypeId:google.maps.MapTypeId.ROADMAP};c=new google.maps.Map(h("#map_modal_map")[0],c);if(a.map.markers)for(o=0;o<a.map.markers.length;o++){D=a.map.markers[o];new google.maps.MarkerImage(D.image,new google.maps.Size(24,32),new google.maps.Point(0,0),new google.maps.Point(0,32));f=D.latlong.split(",");f=new google.maps.LatLng(f[0],f[1]);D=new google.maps.Marker({position:f,
map:c,icon:D.icon,title:D.title,zIndex:D.zIndex})}}else D==true&&f.find("#insert").append("<iframe width='100%' height='300' src='"+a.video+"'></iframe></div>");a=k.dimensions.container.height;o=k.dimensions.container.width;D=h(e+" .full_modal_panel");f=D.width();c=D.height();D.css({top:(a-c)/2+"px",left:(o-f)/2+"px"});break;case "video":f=h.tmpl(k._templates.event_modal_video,f);f.appendTo(q).css("z-index",k.ztop++).position({my:"right center",at:"left center",of:c,offset:"-12, -1",collision:"flip fit"}).hover(function(){h(this).css("z-index",
k.ztop++)});break;default:f=h.tmpl(k._templates.event_modal_small,f);f.appendTo(q).css("z-index",k.ztop++).position({my:"center top",at:"center top",of:e,offset:"0, 100",collision:"fit fit"}).draggable().hover(function(){h(this).css("z-index",k.ztop++)})}},legendModal:function(f){var k=p.timelineCollection.get(f).attributes.legend,o=0,D="",c="",a="";o="";for(o=0;o<k.length;o++){D=H.icon_folder+k[o].icon;c=k[o].title;a+="<li><img class='legend-icon' src='"+D+"'><span class='legend-info'>"+c+"</span></li>"}f=
{id:f,legend_list:a};h(e+" .timeglider-legend").remove();h.tmpl(this._templates.legend_modal,f).appendTo(e).css("z-index",this.ztop++).toggleClass("timeglider-display-none").position({my:"left top",at:"left top",of:e,offset:"16, -4",collision:"none none"});o=timeglider.mode==="authoring"?e+" .legend-info":e+" .legend-info, "+e+" .legend-icon";h(o).bind("mouseup",function(n){n=h(n.target).parent().children("img").attr("src");h(this).parent().toggleClass("tg-legend-icon-selected");p.setFilters({origin:"legend",
icon:n})})},parseHTMLTable:function(f){var k={},o=+new Date,D=[];h("#"+f).find("tr").each(function(c){var a=h(this).children(),n;if(c===0)D=a.map(function(){return h(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{n={};a.each(function(g){n[D[g]]=h(this).text()});k["prefix"+o++]=n}});return k}};r.TG_TimelineView=Backbone.View.extend({initialize:function(){var f=this;this.model.bind("change:title",function(){h(f.el).find(".timeline-title-span").text(f.model.get("title"))});this.model.bind("destroy",
this.remove,this)},tagName:"div",events:{"click .timeline-title-span":"titleClick"},className:"tg-timeline-envelope",getTemplate:function(){var f="<div class='titleBar'><div class='timeline-title'><span class='timeline-title-span'>${title}</span><div class='tg-timeline-env-buttons'>";if(this.model.get("description"))f+="<span class='timeline-info' data-timeline_id='${id}'>info</span>";if(this.model.get("hasLegend"))f+="<span class='tg-timeline-legend-bt' data-timeline_id='${id}'>legend</span>";f+=
"<span class='expand-collapse' data-timeline_id='${id}'>exp/col</span>";f+="</div></div></div>";return f},render:function(){this.model.get("id");this.model.get("title");var f=this.getTemplate();h(this.el).html(h.tmpl(f,this.model.attributes)).attr("id",this.model.get("id"));return this},setText:function(){},titleClick:function(){p.timelineTitleClick(this.model.get("id"))},remove:function(){h(this.el).remove()}});r.zoomTree=[{},{unit:"da",width:35E3,level:1,label:"5 hours"},{unit:"da",width:17600,
level:2,label:"7 hours"},{unit:"da",width:8800,level:3,label:"10 hours"},{unit:"da",width:4400,level:4,label:"12 hours"},{unit:"da",width:2200,level:5,label:"14 hours"},{unit:"da",width:1100,level:6,label:"17 hours"},{unit:"da",width:550,level:7,label:"22 hours"},{unit:"da",width:432,level:8,label:"1 DAY"},{unit:"da",width:343,level:9,label:"1.5 days"},{unit:"da",width:272,level:10,label:"2 days"},{unit:"da",width:216,level:11,label:"2.5 days"},{unit:"da",width:171,level:12,label:"3 days"},{unit:"da",
width:136,level:13,label:"3.5 days"},{unit:"da",width:108,level:14,label:"4 days"},{unit:"mo",width:2509,level:15,label:"6 days"},{unit:"mo",width:1945,level:16,label:"1 WEEK"},{unit:"mo",width:1508,level:17,label:"10 days"},{unit:"mo",width:1169,level:18,label:"2 weeks"},{unit:"mo",width:913,level:19,label:"2.5 weeks"},{unit:"mo",width:719,level:20,label:"3 weeks"},{unit:"mo",width:566,level:21,label:"3.5 weeks"},{unit:"mo",width:453,level:22,label:"1 MONTH"},{unit:"mo",width:362,level:23,label:"5.5 weeks"},
{unit:"mo",width:290,level:24,label:"7 weeks"},{unit:"mo",width:232,level:25,label:"2 months"},{unit:"mo",width:186,level:26,label:"2.5 months"},{unit:"mo",width:148,level:27,label:"3 months"},{unit:"mo",width:119,level:28,label:"4 months"},{unit:"mo",width:95,level:29,label:"5 months"},{unit:"mo",width:76,level:30,label:"6 months"},{unit:"ye",width:723,level:31,label:"9 months"},{unit:"ye",width:573,level:32,label:"1 YEAR"},{unit:"ye",width:455,level:33,label:"1.25 years"},{unit:"ye",width:361,level:34,
label:"1.5 years"},{unit:"ye",width:286,level:35,label:"2 years"},{unit:"ye",width:227,level:36,label:"2.5 years"},{unit:"ye",width:179,level:37,label:"3 years"},{unit:"ye",width:142,level:38,label:"4 years"},{unit:"ye",width:113,level:39,label:"5 years"},{unit:"ye",width:89,level:40,label:"6 years"},{unit:"de",width:705,level:41,label:"8 years"},{unit:"de",width:559,level:42,label:"10 years"},{unit:"de",width:443,level:43,label:"13 years"},{unit:"de",width:302,level:44,label:"16 years"},{unit:"de",
width:240,level:45,label:"20 years"},{unit:"de",width:190,level:46,label:"25 years"},{unit:"de",width:150,level:47,label:"30 years"},{unit:"de",width:120,level:48,label:"40 years"},{unit:"de",width:95,level:49,label:"50 years"},{unit:"de",width:76,level:50,label:"65 years"},{unit:"ce",width:600,level:51,label:"80 years"},{unit:"ce",width:480,level:52,label:"100 years"},{unit:"ce",width:381,level:53,label:"130 years"},{unit:"ce",width:302,level:54,label:"160 years"},{unit:"ce",width:240,level:55,label:"200 years"},
{unit:"ce",width:190,level:56,label:"250 years"},{unit:"ce",width:150,level:57,label:"300 years"},{unit:"ce",width:120,level:58,label:"400 years"},{unit:"ce",width:95,level:59,label:"500 years"},{unit:"ce",width:76,level:60,label:"600 years"},{unit:"thou",width:603,level:61,label:"1000 years"},{unit:"thou",width:478,level:62,label:"1200 years"},{unit:"thou",width:379,level:63,label:"1800 years"},{unit:"thou",width:301,level:64,label:"160 years"},{unit:"thou",width:239,level:65,label:"xxx years"},
{unit:"thou",width:190,level:66,label:"xxx years"},{unit:"thou",width:150,level:67,label:"xxx years"},{unit:"thou",width:120,level:68,label:"xxx years"},{unit:"thou",width:95,level:69,label:"8,000 years"},{unit:"thou",width:76,level:70,label:"10,000 years"},{unit:"tenthou",width:603,level:71,label:"15,000 years"},{unit:"tenthou",width:358,level:72,label:"20,000 years"},{unit:"tenthou",width:213,level:73,label:"30,000 years"},{unit:"tenthou",width:126,level:74,label:"60,000 years"},{unit:"tenthou",
width:76,level:75,label:"100,000 years"},{unit:"hundredthou",width:603,level:76,label:"180,000 years"},{unit:"hundredthou",width:358,level:77,label:"300,000 years"},{unit:"hundredthou",width:213,level:78,label:"500,000 years"},{unit:"hundredthou",width:126,level:79,label:"800,000 years"},{unit:"hundredthou",width:76,level:80,label:"1 million years"},{unit:"mill",width:603,level:81,label:"1.2 million years"},{unit:"mill",width:358,level:82,label:"2 million years"},{unit:"mill",width:213,level:83,label:"3 million years"},
{unit:"mill",width:126,level:84,label:"5 million years"},{unit:"mill",width:76,level:85,label:"10 million years"},{unit:"tenmill",width:603,level:86,label:"15 million years"},{unit:"tenmill",width:358,level:87,label:"30 million years"},{unit:"tenmill",width:213,level:88,label:"50 million years"},{unit:"tenmill",width:126,level:89,label:"80 million years"},{unit:"tenmill",width:76,level:90,label:"100 million years"},{unit:"hundredmill",width:603,level:91,label:"120 million years"},{unit:"hundredmill",
width:358,level:92,label:"200 million years"},{unit:"hundredmill",width:213,level:93,label:"300 million years"},{unit:"hundredmill",width:126,level:94,label:"500 million years"},{unit:"hundredmill",width:76,level:95,label:"1 billion years"},{unit:"bill",width:603,level:96,label:"15 million years"},{unit:"bill",width:358,level:97,label:"30 million years"},{unit:"bill",width:213,level:98,label:"50 million years"},{unit:"bill",width:126,level:99,label:"80 million years"},{unit:"bill",width:76,level:100,
label:"100 billion years"}];r.calculateSecPerPx=function(f){for(var k=1;k<f.length;k++){var o=f[k],D=0;switch(o.unit){case "da":D=86400;break;case "mo":D=2419200;break;case "ye":D=31536E3;break;case "de":D=31536E4;break;case "ce":D=31536E5;break;case "thou":D=31536E6;break;case "tenthou":D=31536E7;break;case "hundredthou":D=31536E8;break;case "mill":D=31536E9;break;case "tenmill":D=31536E10;break;case "hundredmill":D=31536E11;break;case "bill":D=31536E12}o.spp=D/parseInt(o.width)}}(r.zoomTree);r.getStringWidth=
function(f){if(f)return h("#timeglider-measure-span").html(f).width()};String.prototype.removeWhitespace=function(){return this.replace(RegExp("\\n","g"),"")};if(debug)debug.trace=function(f,k){h("#"+k).text(f)};r.googleMapsInit=function(){};r.googleMapsLoaded=false;r.googleMapsLoad=function(){if(r.googleMapsLoaded==false){var f=document.createElement("script");f.type="text/javascript";f.src="http://maps.googleapis.com/maps/api/js?sensor=false&callback=timeglider.googleMapsInit";document.body.appendChild(f);
r.googleMapsLoaded=true}}})(timeglider);(function(r){var F={},A=r.TG_Date,p={},H=jQuery,B={};r.TG_Mediator=function(x,w){this.options=p=x;B=w;this._focusDate={};this._zoomInfo={};this._zoomLevel=1;this.ticksReady=false;this.ticksArray=[];this.startSec=0;this.activeTimelines=[];this.max_zoom=p.max_zoom;this.min_zoom=p.min_zoom;this.icon_folder=r.icon_folder=p.icon_folder||"js/timeglider/icons/";this.timeOffset=A.getTimeOffset(p.timezone);this.fixed_zoom=this.max_zoom==this.min_zoom?true:false;this.gesturing=false;this.gestureStartScale=
this.gestureStartZoom=0;this.filters={include:"",exclude:"",legend:[]};this.timelineCollection=new r.TG_TimelineCollection;this.eventCollection=new r.TG_EventCollection;this.imagesToSize=this.imagesSized=0;this.timelineDataLoaded=false;this.initial_timeline_id=p.initial_timeline_id||"";this.sole_timeline_id="";this.dimensions={};this.focusedEvent="";if(p.max_zoom===p.min_zoom)this.fixed_zoom=p.min_zoom;if(p.main_map){this.main_map=p.main_map;timeglider.mapping.setMap(this.main_map,this)}F=this};r.TG_Mediator.prototype=
{focusToEvent:function(x){this.focusedEvent=x;this.setFocusDate(x.startdateObj);H.publish("mediator.focusToEvent")},gotoDateZoom:function(x,w){var h=false;this.setFocusDate(new A(x));if(w)h=this.setZoomLevel(w);if(!w||h==false)this.refresh()},zoom:function(x){this.setZoomLevel(this.getZoomLevel()+parseInt(x))},getScope:function(){var x=this.getZoomInfo(),w=this.getFocusDate(),h=this.getActiveTimelinesBounds();return{spp:Math.round(x.spp),width:this.dimensions.container.width,focusDateSec:Math.round(w.sec),
timelines:this.activeTimelines,timelineBounds:h,container:B}},getActiveTimelinesBounds:function(){for(var x=this.activeTimelines,w={},h=99999999999,I=0,C=0;C<x.length;C++){w=this.timelineCollection.get(x[C]);h=w.get("bounds").first<h?w.get("bounds").first:h;I=w.get("bounds").last>I?w.get("bounds").last:I}return{first:h,last:I}},loadTimelineData:function(x){var w=this;if(x)if(typeof x==="object")w.parseTimelineData(x);else if(x.substr(0,1)=="#"){x=[w.getTableTimelineData(x)];w.parseTimelineData(x)}else H.getJSON(x,
function(h){w.parseTimelineData(h)});else{this.timelineDataLoaded=true;this.setZoomLevel(Math.floor((this.max_zoom+this.min_zoom)/2));this.tryLoading()}},mapMarkerClick:function(x){this.focusToEvent(x)},getTimelineCollection:function(){return this.timelineCollection},timelineTitleClick:function(x){H.publish("mediator.timelineTitleClick",{timeline_id:x})},getTableTimelineData:function(x){var w={},h=0,I=[],C,e,q="",s=H(x);w.id=x.substr(1);w.title=s.attr("title")||"untitled";w.description=s.attr("description")||
"";w.focus_date=s.attr("focus_date")||A.getToday;w.initial_zoom=s.attr("initial_zoom")||20;w.events=[];s.find("tr").each(function(z){var f=H(this).children(),k;if(z===0)I=f.map(function(){return H(this).attr("class").replace(/^.*?\btg-(\S+)\b.*?$/,"$1")}).get();else{k={};f.each(function(o){C=I[o];e=H(this).text();k[C]=e});q="ev_"+h++;k.id=q;w.events.push(k)}});s.css("display","none");return w},parseTimelineData:function(x){var w=0,h=x.length,I={};I={};for(var C=0;C<h;C++){I=x[C];I.mediator=this;I=
(new r.TG_Timeline(I)).toJSON();if(I.id.length>0){w++;this.swallowTimeline(I)}}if(w===0)alert("ERROR loading data: Check JSON with jsonLint");else{this.timelineDataLoaded=true;this.tryLoading()}},tryLoading:function(){var x=this.timelineDataLoaded==true;if(this.imagesSized==this.imagesToSize&&x){this.setInitialTimelines();H.publish("mediator.timelineDataLoaded")}},swallowTimeline:function(x){this.sole_timeline_id=x.id;this.timelineCollection.add(x);H.publish("mediator.timelineListChangeSignal")},
setInitialTimelines:function(){var x=this.initial_timeline_id||this.sole_timeline_id;if(timeglider.mode=="authoring")this.setZoomLevel(40);else x?setTimeout(function(){F.toggleTimeline(x)},500):this.setZoomLevel(40)},refresh:function(){this.startSec=this._focusDate.sec;H.publish("mediator.refreshSignal")},setTicksReady:function(x){this.ticksReady=x;x===true&&H.publish("mediator.ticksReadySignal")},setTimeoffset:function(x){this.timeOffset=A.getTimeOffset(x);this.refresh()},getTimeoffset:function(){return this.timeOffset},
setDimensions:function(x){this.dimensions=x},setFocusDate:function(x){if(x!=this._focusDate)this._focusDate=x},getFocusDate:function(){return this._focusDate},getZoomLevel:function(){return parseInt(this._zoomLevel)},setZoomLevel:function(x){if(x<=this.max_zoom&&x>=this.min_zoom){this.startSec=this._focusDate.sec;if(x!=this._zoomLevel){this._zoomLevel=x;this._zoomInfo=r.zoomTree[x];H.publish("mediator.zoomLevelChange");H.publish("mediator.scopeChange");return true}else return false}else return false},
getZoomInfo:function(){return this._zoomInfo},registerUIEvent:function(x){switch(x.name){case "dblclick":x=x.event.pageX-x.dimensions.container.offset.left-x.dimensions.container.width/2;var w=this.getZoomInfo().spp,h=this.getFocusDate().sec;x=new A(Math.floor(h+x*w));H.publish("mediator.dblclick",{date:x})}},setFilters:function(x){switch(x.origin){case "clude":this.filters.include=x.include;this.filters.exclude=x.exclude;break;case "legend":var w=x.icon.replace(this.options.icon_folder,"");if(w==
"all"){this.filters.legend=[];H.publish("mediator.legendAll")}else if(H.inArray(w,this.filters.legend)==-1)this.filters.legend.push(w);else{x=[];x=H.grep(this.filters.legend,function(h){return h!=w});this.filters.legend=x}}H.publish("mediator.filtersChange");H.publish("mediator.scopeChange");this.refresh()},getTicksOffset:function(){return this._ticksOffset},setTicksOffset:function(x){this._ticksOffset=x;H.publish("mediator.ticksOffsetChange");H.publish("mediator.scopeChange")},getTickBySerial:function(x){for(var w=
this.ticksArray,h=w.length,I=0;I<h;I++){var C=w[I];if(C.serial==x)return C}return false},addToTicksArray:function(x,w){if(x.type=="init"){x.serial=A.getTimeUnitSerial(w,x.unit);this.ticksArray=[x]}else if(x.type=="l"){x.serial=this.ticksArray[0].serial-1;this.ticksArray.unshift(x)}else{x.serial=this.ticksArray[this.ticksArray.length-1].serial+1;this.ticksArray.push(x)}H.publish("mediator.ticksArrayChange");return x.serial},toggleTimeline:function(x){var w=this.timelineCollection.get(x).attributes,
h=H.inArray(x,this.activeTimelines);if(h==-1){this.activeTimelines.push(x);this.setFocusDate(new A(w.focus_date));this.setZoomLevel(w.initial_zoom)}else{this.activeTimelines.splice(h,1);this.refresh()}H.publish("mediator.activeTimelinesChange")},reportImageSize:function(x){var w=F.eventCollection.get(x.id);if(w.has("image")){if(x.error){w.attributes.image={};debug.log("WHOOPS: MISSING IMAGE: "+x.src)}else{w.attributes.image.width=x.width;w.attributes.image.height=x.height}this.imagesSized++;this.imagesSized==
this.imagesToSize&&this.tryLoading()}}};r.getLowHigh=function(x){x=_.sortBy(x,function(w){return parseInt(w)});return{low:_.first(x),high:_.last(x)}};r.validateOptions=function(x){this.optionsMaster={initial_focus:{type:"date"},timezone:{type:"timezone"},editor:{type:"string"},backgroundColor:{type:"color"},backgroundImage:{type:"color"},min_zoom:{type:"number",min:1,max:100},max_zoom:{type:"number",min:1,max:100},initial_zoom:{type:"number",min:1,max:100},show_centerline:{type:"boolean"},display_zoom_level:{type:"boolean"},
data_source:{type:"url"},basic_fontsize:{type:"number",min:9,max:100},mouse_wheel:{type:"string",possible:["zoom","pan"]},initial_timeline_id:{type:"string"},icon_folder:{type:"string"},show_footer:{type:"boolean"},display_zoom_level:{type:"boolean"},event_modal:{type:"object"},event_overflow:{type:"string"}};var w=this,h="";H.each(x,function(I,C){if(w.optionsMaster[I])switch(w.optionsMaster[I].type){case "string":if(typeof C!="string")h+=I+" needs to be a string.\n";if(w.optionsMaster[I].possible)if(H.inArray(C,
w.optionsMaster[I].possible)==-1)h+=I+" must be: "+w.optionsMaster[I].possible.join(" or ");break;case "number":if(typeof C!="number")h+=C+" needs to be a number.\n";if(w.optionsMaster[I].min)if(C<w.optionsMaster[I].min)h+=I+" must be greater than or equal to "+w.optionsMaster[I].min+"\n";if(w.optionsMaster[I].max)if(C>w.optionsMaster[I].max)h+=I+" must be less than or equal to "+w.optionsMaster[I].max+"\n";break;case "timezone":var e=/[+|-]?[0-9]+:[0-9]+/;if(H.inArray(C,["New York","Denver","Chicago",
"Los Angeles"])==-1&&C.match(e)==-1)h+="The timezone is not formatted properly";break;case "boolean":if(typeof C!="boolean")h+=C+" needs to be a number.\n"}});return h}})(timeglider);(function(r){var F,A,p=timeglider,H=timeglider.TG_Date;r.widget("timeglider.timeline",{options:{timezone:"00:00",initial_focus:p.TG_Date.getToday(),editor:"none",min_zoom:1,max_zoom:100,show_centerline:true,data_source:"",culture:"en",basic_fontsize:12,mouse_wheel:"zoom",initial_timeline_id:"",icon_folder:"js/timeglider/icons/",show_footer:true,display_zoom_level:true,event_modal:{href:"",type:"default"},event_overflow:"plus"},_create:function(){this._id=r(this.element).attr("id");this.element.html("<div class='timeglider-container'><div class='timeglider-loading'>loading</div><div class='timeglider-centerline'></div><div class='timeglider-date-display'></div><div class='timeglider-truck' id='tg-truck'><div class='timeglider-ticks'><div class='timeglider-handle'></div></div></div><div class='timeglider-slider-container'><div class='timeglider-slider'></div><div class='timeglider-pan-buttons'><div class='timeglider-pan-left'></div><div class='timeglider-pan-right'></div></div></div><div class='timeglider-footer'><div class='timeglider-logo'></div><div class='timeglider-footer-button timeglider-filter-bt'></div><div class='timeglider-footer-button timeglider-settings-bt'></div><div class='timeglider-footer-button timeglider-list-bt'></div></div><div class='timeglider-event-hover-info'></div></div><span id='timeglider-measure-span'></span>")},
_init:function(){var B=timeglider.validateOptions(this.options);if(B==""){p.TG_Date.setCulture(this.options.culture);A=new p.TG_Mediator(this.options,this.element);F=new p.TG_PlayerView(this,A);A.setFocusDate(new H(this.options.initial_focus));A.loadTimelineData(this.options.data_source)}else alert("Rats. There's a problem with your widget settings:"+B)},goTo:function(B,x){A.gotoDateZoom(B,x)},resize:function(){F.resize()},getMediator:function(){return A},getScope:function(){return A.getScope()},
zoom:function(B){switch(B){case "in":B=-1;break;case "out":B=1}if(B>99||B<-99)return false;A.zoom(B)},load:function(B){A.loadTimelineData(B)},panButton:function(B,x){var w=0;switch(x){case "left":w=30;break;case "right":w=-30;break;default:w=x}F.setPanButton(B,w)},destroy:function(){r.Widget.prototype.destroy.apply(this,arguments);r(this.element).html("")}})})(jQuery);
